const URL_BASE="http://localhost/gdagmcp",token=JSON.parse(localStorage.getItem("token"));let errores;async function iniciarApp(){errores=await traerErrores(),console.log(errores),dibujarErrores()}function alertas(){const t=document.querySelectorAll(".alert"),e=document.getElementById("alertas"),a=document.querySelector("#alertaTipo");t&&setTimeout(()=>{t.forEach((function(t){t.remove(),e&&(e.innerHTML=""),a&&(a.innerHTML="")}))},3e3)}function traerErrores(){return new Promise((t,e)=>{let a=[];$.ajax({data:{tipo:"errores"},url:URL_BASE+"/errores/datos",type:"POST",headers:{token:token},dataType:"json"}).done(e=>{e.exit&&Swal.fire({icon:"warning",title:e.exit,showConfirmButton:!1,text:"Sesión expirada, vuelva a iniciar sesión",timer:3e3}).then(()=>{window.location.href=URL_BASE+"/?r=8"}),0==e.length&&t(a),$.each(e,(r,s)=>{a.push(s),e.length==r+1&&t(a)})}).fail(t=>{e(t)})})}async function dibujarErrores(){var t="";let e=await traerErrores();t+='<h1 class="text-black mb-4"><strong>Administrar Errores</strong></h1>',t+='<table class="table" style="min-width:900px" id="tablaError">',t+='<thead class="table-dark">',t+='<tr class="" style="text-transform:uppercase">',t+="<th>N°</th>",t+='<th class="">Table</th>',t+='<th class="">Controller</th>',t+='<th class="">Function</th>',t+='<th class="">Data</th>',t+='<th class="">Error</th>',t+='<th class="">Fecha</th>',t+='<th class="">Status</th>',t+="</tr>",t+="</thead>",t+='<tbody class="contenido" id="contenido">',e.forEach((e,a)=>{console.log("error",e),t+="<tr>",t+="<td>"+(parseInt(a)+1)+"</td>",t+="<td>"+e.tabla_error+"</td>",t+="<td>"+e.controller_error+"</td>",t+="<td>"+e.function_error+"()</td>",t+='<td><buttom class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModalError'+e.id+'"><i class="fa-solid fa-eye fa-xl"></></buttom></td>',t+='<td class="col-4">'+e.error+"</td>",t+="<td>"+e.created_at.split(" ")[0]+"</td>",t+="<td> Status</td>",t+="</tr>",t+='<div class="modal fade" id="exampleModalError'+e.id+'" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">',t+=' <div class="modal-dialog">',t+=' <div class="modal-content">',t+=' <div class="modal-header bg-black">',t+=' <h4 class="modal-title text-white" id="exampleModalLabel">Datos ingresados</h4>',t+='<button type="button" class="btn text-white" style="font-size:11px" data-bs-dismiss="modal" aria-label="Close"><i class="fa-solid fa-x fa-lg"></i></button>',t+=" </div>",t+=' <div class="modal-body">';let r=JSON.parse(e.data),s=JSON.parse(r.data);r.user&&(t+=' <div class="d-flex w-100">',t+=' <p style="font-size:14px"><strong>Usuario: </strong> '+r.user+"</p>",t+=" </div>"),console.log("datosFormm",s),s.forEach((e,a)=>{t+=' <div class=" w-100 text-justify">',t+=' <p class="text-justify" style="font-size:14px"><strong>'+(e.nombre[0].toUpperCase()+e.nombre.substring(1))+": </strong></p>",t+=' <p style="font-size:14px;text-align:justify">'+e.valor+"</p>",t+=" </div>"}),t+=" </div>",t+='<div class="modal-footer">',t+=' <button type="button" class="btn btn-outline-danger" data-bs-dismiss="modal">Cerrar</button>',t+="</div>",t+="</div>",t+=" </div>",t+="</div>"}),t+="</tbody>",t+="</table>",document.getElementById("dibujar-js").innerHTML=t,$("#tablaError").DataTable()}document.addEventListener("DOMContentLoaded",iniciarApp());