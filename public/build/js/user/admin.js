const URL_BASE="http://localhost/gdagmcp";let usuarios,unidades,secciones,usuariosSeccion,roles;const user={nombre:"",apellido:"",cedula:"",celular:"",email:"",password:"",idUnidad:"",idRol:""};let permisosDefault=[{id:"1",nombre:"Leer",status:"false"},{id:"2",nombre:"Escribir",status:"false"}];const token=JSON.parse(localStorage.getItem("token"));async function iniciarApp(){usuarios=await traerUsers(),usuariosSeccion=await buscarSeccion(),secciones=await traerSecciones(),unidades=await traerUnidades(),roles=await traerRoles(),await dibujarBotones(),dibujarUsuarios("dibujar-js",1,usuarios),crearModales()}function alertas(){const e=document.querySelectorAll(".alert"),a=document.getElementById("alertas"),t=document.querySelector("#alertaTipo");e&&setTimeout(()=>{e.forEach((function(e){e.remove(),a&&(a.innerHTML=""),t&&(t.innerHTML="")}))},3e3)}async function traerUser(e){let a=JSON.parse(localStorage.getItem("buscarUser")),t=await traerUsers();if(a&&a.length>0){let e=a.map(e=>t.find(a=>a.id===e.id));localStorage.setItem("buscarUser",JSON.stringify(e))}if("1"==e)dibujarUsuarios("dibujar-js",1,t);else if("2"==e){console.log("debe entrar aqui por el tipo 2");const e=JSON.parse(localStorage.getItem("buscarUser"));console.log("user del local antes de dibujar, debo estar solo yo",e),dibujarUsuarios("tablaBuscar",2,e)}}function traerUsers(){return new Promise((e,a)=>{let t=[];$.ajax({data:{tipo:"usuarios"},url:URL_BASE+"/user/datos",type:"POST",headers:{token:token},dataType:"json"}).done(a=>{a.exit&&Swal.fire({icon:"warning",title:a.exit,showConfirmButton:!1,text:"Sesión expirada, vuelva a iniciar sesión",timer:3e3}).then(()=>{window.location.href=URL_BASE+"/?r=8"}),0==a.length&&e(t),$.each(a,(o,i)=>{t.push(i),a.length==o+1&&e(t)})}).fail(e=>{a(e)})})}function findUserById(e){return new Promise((a,t)=>{$.ajax({data:{id:e,tipo:"usuario"},url:URL_BASE+"/user/datos",type:"POST",headers:{token:token},dataType:"json"}).done(e=>{e.exit&&Swal.fire({icon:"warning",title:e.exit,showConfirmButton:!1,text:"Sesión expirada, vuelva a iniciar sesión",timer:3e3}).then(()=>{window.location.href=URL_BASE+"/?r=8"}),a(e)}).fail(e=>{t(e)})})}function traerUnidades(){return new Promise((e,a)=>{let t=[];$.ajax({data:{tipo:"unidades"},url:URL_BASE+"/user/datos",type:"POST",headers:{token:token},dataType:"json"}).done(a=>{a.exit&&Swal.fire({icon:"warning",title:a.exit,showConfirmButton:!1,text:"Sesión expirada, vuelva a iniciar sesión",timer:3e3}).then(()=>{window.location.href=URL_BASE+"/?r=8"}),0==a.length&&e(t),$.each(a,(o,i)=>{t.push(i),a.length==o+1&&e(t)})}).fail(e=>{a(e)})})}function traerSecciones(){return new Promise((e,a)=>{let t=[];$.ajax({data:{tipo:"seccion"},url:URL_BASE+"/user/datos",type:"POST",headers:{token:token},dataType:"json"}).done(a=>{a.exit&&Swal.fire({icon:"warning",title:a.exit,showConfirmButton:!1,text:"Sesión expirada, vuelva a iniciar sesión",timer:3e3}).then(()=>{window.location.href=URL_BASE+"/?r=8"}),0==a.length&&e(t),$.each(a,(o,i)=>{t.push(i),a.length==o+1&&e(t)})}).fail(e=>{a(e)})})}function traerRoles(){return new Promise((e,a)=>{let t=[];$.ajax({data:{tipo:"roles"},url:URL_BASE+"/user/datos",type:"POST",headers:{token:token},dataType:"json"}).done(a=>{a.exit&&Swal.fire({icon:"warning",title:a.exit,showConfirmButton:!1,text:"Sesión expirada, vuelva a iniciar sesión",timer:3e3}).then(()=>{window.location.href=URL_BASE+"/?r=8"}),0==a.length&&e(t),$.each(a,(o,i)=>{t.push(i),a.length==o+1&&e(t)})}).fail(e=>{a(e)})})}function carpetaById(e){return new Promise((a,t)=>{$.ajax({data:{tipo:"findCarpeta",id:e},url:URL_BASE+"/carpeta/datos",type:"POST",headers:{token:token},dataType:"json"}).done(e=>{e.exit&&Swal.fire({icon:"warning",title:e.exit,showConfirmButton:!1,text:"Sesión expirada, vuelva a iniciar sesión",timer:3e3}).then(()=>{window.location.href=URL_BASE+"/?r=8"}),a(e)}).fail(e=>{t(e)})})}function traerSeccionesHijos(){return new Promise((e,a)=>{let t=[];$.ajax({data:{tipo:"hijos",id:id},url:URL_BASE+"/carpeta/datos",type:"POST",headers:{token:token},dataType:"json"}).done(a=>{a.exit&&Swal.fire({icon:"warning",title:a.exit,showConfirmButton:!1,text:"Sesión expirada, vuelva a iniciar sesión",timer:3e3}).then(()=>{window.location.href=URL_BASE+"/?r=8"}),0==a.length&&e(t),$.each(a,(o,i)=>{t.push(i),a.length==o+1&&e(t)})}).fail(e=>{a(e)})})}async function dibujarBotones(){document.getElementById("dibujar-botones").innerHTML=' <h1 class="text-black"><strong>Administrar Usuarios</strong></h1> <section> <div class="contenedor-acciones bg-light"> <div class="barra-acciones"> <div class=" contenedor-boton"> <a class="cboton btn btn-warning w-100" onclick="dibujarUsuarios(\'dibujar-js\',1)"><i class="fa-solid fa-users fa-2x"></i> <span class="span-boton">Ver usuarios</span></a> </div> <div class="contenedor-boton"> <a class="cboton btn btn-success w-100" id="crear" onclick="crearUsuario()"><i class="fa-solid fa-user-plus fa-2x"></i> <span class="span-boton">Crear usuarios</span></a> </div> <div class=" contenedor-boton"> <a class="cboton btn btn-primary w-100" onclick="buscarUsuario()"><i class="fa-solid fa-magnifying-glass fa-2x"></i> <span class="span-boton">Buscar usuarios</span></a> </div> </div> </div></section>'}async function dibujarUsuarios(e,a=1,t=[]){console.log("usuarios del dibujar directo del localS",t),0==t.length&&(t=await traerUsers()),console.log("usuarios del dibujar",t);var o="";o+='<table class="table" style="min-width:900px" id="tablaUsuarios">',o+='<thead class="table-dark">',o+='<tr class="" style="text-transform:uppercase">',o+="<th>N°</th>",o+="<th>Nombre</th>",o+="<th>Email</th>",o+="<th>rol</th>",o+="<th>Unidad</th>",o+="<th>Estado</th>",o+="<th>Acciones</th>",o+="</tr>",o+="</thead>",o+='<tbody class="contenido" id="contenido">',t.forEach((e,t)=>{let i="activo"==e.estado?"btn-outline-success":"btn-outline-danger";o+='<tr class="">',o+="<td>"+(parseInt(t)+1)+"</p></td>",o+='<td class="col-2">'+e.nombre+"</p></td>",o+='<td class="col-3">'+e.email+"</p></td>",o+='<td class="col-1">'+e.rol+"</p></td>",o+='<td class="col-2">'+e.unidad+"</p></td>",o+='<td class="col-1"><a class=" btn btn-rounded '+i+'" onclick="estado('+e.id+","+a+')"  >'+e.estado+"</a></p></td>",o+='<td class="col-2">',o+='<div class="acciones-user">',o+='<a class="btn btn-primary" id="'+a+'" onclick="permisosUser('+e.id+')" style="margin:0px 0px 0px 5px">Permisos</a>',o+='<a class="btn btn-warning " id="'+a+'" onclick="crearUsuario(2,'+e.id+')" style="margin:0px 5px 0px 5px"><i class="fa-regular fa-pen-to-square fa-2x"></i></a>',o+='<a class="btn btn-danger " onclick="eliminarUsuario('+e.id+')"><i class="fa-solid fa-trash fa-2x"></i></a>',o+="</div>",o+="</td>",o+="</tr>"}),o+="</tbody>",o+="</table>",document.getElementById(e.toString()).innerHTML=o,$("#tablaUsuarios").DataTable()}async function permisosUser(e){let a=await findUserById(e);console.log("user",a);var t="";t+='<h1 class="text-black"><strong>Administrar Permisos</strong></h1>',t+='<div class="contenedor-crearUsuario bg-light my-4">',t+='<h3 class="text-black">Permisos de '+a.nombre+"</h3>",t+='<div class="mb-3">',t+='<label for="exampleFormControlInput1" class="form-label"><strong>Buscar por:</strong></label>',t+='<select class="form-select selectDocumentos" name="tipo" id="tipo" onchange="elegirTipo()">',t+='<option value="" selected disabled> --  Seleccione una opción -- </option>',t+='<option value="1">Nombre</option>',t+='<option value="2">Rol</option>',t+='<option value="3">Unidad</option>',t+="</select>",t+="</div>",t+='<div id="elegir">',t+="</div>",t+="</div>",t+='<div id="tablaBuscar">',t+="</div>",t+="</div>",document.getElementById("dibujar-botones").innerHTML="",document.getElementById("dibujar-js").innerHTML=t;let o=await generarCarpetas(0);console.log("hola",o)}async function generarCarpetas(e){let a;if(0==e)a="Base";else{let t=await carpetaById(e);console.log("nombre de la carpeta",t),a=t.seccion}console.log("seccion",a);let t={nombre:a,hijos:[]},o=await traerSeccionesHijos(e);return console.log("carpetas",o),o.forEach(e=>{const a=generarCarpetas(e.id);t.hijos.push(a)}),t}async function crearModales(e=1){let a=await buscarSeccion();var t="";a.forEach(a=>{let o=JSON.parse(a.seccion);console.log("permiso de cada user",o),t+='<div class="modal fade" id="exampleModalPermisos'+a.id+'" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">',t+='<div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">',t+=' <div class="modal-content">',t+=' <div class="modal-header">',t+=' <h5 class="modal-title" id="exampleModalLabel">EDITAR PERMISOS DE <strong>'+a.nombre.toUpperCase()+"</strong></h5>",t+='  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>',t+=" </div>",t+=' <div class="modal-body">',secciones.forEach(e=>{let i=o.find(a=>a.id==e.id);if(t+='<div class="d-flex justify-content-between" style="font-size:17px" >',null!=i){let o=JSON.parse(i.permisos);t+="<div>",t+='<input class="secciones" type="checkbox" checked id="'+e.id+a.id+'" name="'+e.seccion+'" value="'+e.id+'">',t+=' <label for="'+e.seccion+'">'+e.seccion+"</label>",t+="</div>",t+='<div class="d-flex col-6 justify-content-center" id="contenedor'+e.id+a.id+'" style="font-size:13px">',o.forEach(e=>{"true"==e.status?(t+='<input style="margin-right:5px" type="checkbox" checked id="permiso'+e.id+'" name="'+e.nombre+'" value="'+e.id+'">',t+=' <label style="margin-right:10px ">'+e.nombre+"</label>"):(t+='<input style="margin-right:5px" type="checkbox" id="permiso'+e.id+'" name="'+e.nombre+'" value="'+e.id+'">',t+=' <label style="margin-right:10px ">'+e.nombre+"</label>")}),t+="</div>"}else t+="<div>",t+='<input class="secciones" type="checkbox" id="'+e.id+a.id+'" name="'+e.seccion+'" value="'+e.id+'">',t+=' <label for="'+e.seccion+'">'+e.seccion+"</label>",t+="</div>",t+='<div class="d-flex col-6 justify-content-center visiblePermiso" id="contenedor'+e.id+a.id+'" style="font-size:13px">',permisosDefault.forEach(e=>{t+='<input style="margin-right:5px" type="checkbox"  id="permiso'+e.id+'" name="'+e.nombre+'" value="'+e.id+'">',t+=' <label style="margin-right:10px" >'+e.nombre+"</label>"}),t+="</div>";t+="</div>"}),t+=" </div>",t+='<div class="mx-3" id="alertaError'+a.id+'">',t+="</div>",t+='<div class="modal-footer ">',t+='<div class="d-flex justify-content-between w-100">',a.permisosWhere?t+='<div class="form-text" id="seccionHelp">* Este usuario tiene los permisos de <strong>'+a.permisosWhere+"</strong></div>":t+='<div class="form-text" id="seccionHelp"><strong>* Permisos personalizados</strong></div>',t+="<div>",t+=' <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>',t+=' <button type="button" class="btn btn-success" onclick="guardarPermisos('+a.id+","+e+')">Guardar cambios</button>',t+="</div>",t+="</div>",t+="</div>",t+="</div>",t+=" </div>",t+="</div>",t+=" </div>",t+="</div>",document.getElementById("modales").innerHTML=t})}async function guardarPermisos(e,a=1){let t=document.querySelector(".botonPermiso").id,o=[];secciones.forEach(a=>{let t=document.getElementById(a.id+e);1==t.checked&&o.push({id:t.id,value:t.value,seccion:t.name})}),console.log("deben estar las secciones del usuario",o);let i=[];var n=[];if(o.forEach(e=>{let a=document.getElementById("contenedor"+e.id),t=[];var o=0;for(let i=0;i<a.children.length;i++)if(1==a.children[i].checked)null!=a.children[i].value&&t.push({id:a.children[i].value,nombre:a.children[i].name,status:"true"});else if(null!=a.children[i].value){if(2==++o){let a="No se a seleccionado permisos para la sección de "+e.seccion;n.push(a)}t.push({id:a.children[i].value,nombre:a.children[i].name,status:"false"})}i.push({idSeccion:e,idPermisos:t})}),console.log(n),0!=n.length){let a="";return a+='<ul class="alert bg-white px-5" style="border-radius:5px;border:1px solid red"  style="width:100%" >',n.forEach(e=>{a+='<li class="text-danger"  >',a+=e,a+="</li>"}),a+="</ul>",console.log(document.getElementById("alertaError")),document.getElementById("alertaError"+e).innerHTML=a,void alertas()}{$("#exampleModalPermisos"+e).modal("hide"),console.log("a ver",i);const a=new FormData;a.append("id",e),a.append("permisos",JSON.stringify(i)),console.log([...a]);let o=URL_BASE+"/user/permisos/save";const n=await fetch(o,{method:"POST",headers:{token:token},body:a}),r=await n.json();var s="";console.log(r),r.exito?Swal.fire({position:"top-end",icon:"success",title:r.exito,showConfirmButton:!1,timer:1500}).then(()=>{traerUser(t),document.getElementById("modales").innerHTML="",crearModales()}):r.error?Swal.fire({icon:"error",title:"ERROR",text:r.error}).then(()=>{traerUser(t),document.getElementById("modales").innerHTML="",crearModales()}):r.exit?Swal.fire({icon:"warning",title:r.exit,showConfirmButton:!1,text:"Sesión expirada, vuelva a iniciar sesión",timer:3e3}).then(()=>{window.location.href=URL_BASE+"/?r=8"}):(s+='<ul class="alert bg-white px-5 mt-3" style="border-radius:5px;border:1px solid red"  style="width:100%" >',r.alertas.error.forEach(e=>{s+='<li class="text-danger"  >',s+=e,s+="</li>"}),s+="</ul>",document.getElementById("alertas").innerHTML=s),alertas()}}document.addEventListener("DOMContentLoaded",iniciarApp()),document.addEventListener("click",(function(e){if(e.target.classList.contains("secciones")){let a=e.target,t=document.getElementById("contenedor"+a.id);if(console.log(t),1==a.checked)t.classList.toggle("visiblePermiso"),[].push(a.value);else{t.classList.toggle("visiblePermiso");for(let e=0;e<t.children.length;e++)t.children[e].checked=!1}}}));let datos={nombre:"",apellido:"",cedula:"",celular:"",email:"",unidad:"",rol:""};function crearUsuario(e=1,a){if(console.log("tipoooooo",e),2==e){var t=usuariosSeccion.find(e=>e.id==a);console.log(t);var o=t.nombre.split(" ")[0],i=t.nombre.split(" ")[1],n=t.cedula,s=t.email,r=t.celular,l=t.idUnidad;console.log(l);var d=t.idRol}o||i||n||s||r||l||d||(o="",i="",n="",s="",r="",l="",d="");var c="";c+='<div class="contenedor-crearUsuario bg-light ">',2==e?(c+='<h3 class="text-black mt-2 mb-4">Editar datos de '+o+" "+i+"</h3>",c+=' <input type="hidden" id="idUser" name="id" value="'+t.id+'" placeholder="" required>'):c+='<h3 class="text-black mt-2 mb-4">Ingrese los datos del nuevo usuario</h3>',c+="<form>",c+='<div class="d-flex justify-content-between">',c+='<div class="mb-3 col-md-6" style="padding-right:5px">',c+='<label for="exampleFormControlInput1" class="form-label"><strong>Nombre:</strong></label>',c+=' <input type="text" class="form-control" id="nombre" name="nombre" value="'+o+'" placeholder="" required>',c+="</div>",c+='<div class="mb-3 col-md-6" style="padding-left:5px">',c+='<label for="exampleFormControlInput1" class="form-label"><strong>Apellido:</strong></label>',c+='<input type="text" class="form-control" id="apellido" name="apellido" value="'+i+'" placeholder="" required>',c+="</div>",c+="</div>",c+='<div class="mb-3">',c+='<label for="exampleFormControlInput1" class="form-label"><strong>Cédula:</strong></label>',c+='<input type="number" class="form-control" id="cedula" name="cedula" value="'+n+'" placeholder="1600XXXXXX" aria-label="Username" aria-describedby="basic-addon1">',c+="</div>",c+='<div class="mb-3">',c+='<label for="exampleFormControlInput1" class="form-label"><strong>Celular:</strong></label>',c+='<input type="number" class="form-control" id="celular" value="'+r+'" name="celular" placeholder="098XXXXXXX" aria-label="Username" aria-describedby="basic-addon1">',c+="</div>",c+='<div class="mb-3">',c+='<label for="exampleFormControlInput1" class="form-label"><strong>Email:</strong></label>',c+='<div class="input-group mb-3">',c+='<span class="input-group-text" id="basic-addon1">@</span>',c+='<input type="text" class="form-control" placeholder="" value="'+s+'" id="email" name="email">',c+="</div>",c+="</div>",c+='<div class="mb-3">',c+='<label for="exampleFormControlInput1" class="form-label"><strong>Unidad:</strong></label>',c+='<select class="form-select" name="unidad" id="unidad">',c+='<option  value="" selected disabled> --  Seleccione una opción --</option>',unidades.forEach(e=>{e.id==l?c+='<option value="'+e.id+'" selected>'+e.unidad+" ("+e.jefe+")</option>":c+='<option value="'+e.id+'">'+e.unidad+" ("+e.jefe+")</option>"}),c+="</select>",c+="</div>",c+='<div class="mb-3">',c+='<label for="exampleFormControlInput1" class="form-label"><strong>Rol:</strong></label>',c+='<select class="form-select" name="rol" id="rol">',c+='<option value="" selected disabled> --  Seleccione una opción --</option>',roles.forEach(e=>{e.id==d?c+='<option value="'+e.id+'" selected>'+e.rol+"</option>":c+='<option value="'+e.id+'">'+e.rol+"</option>"}),c+="</select>",c+="</div>",1==e&&(c+='<div class="d-flex ">',c+='<div class="mb-1 col-md-10" style="padding-right:5px">',c+='<label for="exampleFormControlInput1" class="form-label"><strong>Contraseña:</strong></label>',c+='<input type="password" id="password" name="password" class="form-control noallow" placeholder="" disabled>',c+="</div>",c+='<div class="mb-1 col d-flex justify-content-start align-items-end" >',c+='<buttom type="buttom" class="btn btn-warning w-100" id="btnBlock" onclick="llenarPass()">Cambiar contraseña</buttom>',c+="</div>",c+="</div>",c+='<div id="passwordHelp" class="form-text">Si deja en blanco la contraseña será la cédula del nuevo usuario.</div>'),c+='<div class="w-100 mt-2" id="alertas">',c+="</div>",c+='<div class="my-5 d-flex justify-content-center align-items-center">',c+='<a class="btn btn-success px-5 py-2" id="botonCrear" style="font-size:15px" onclick="guardarDatos('+e+')"><i class="fa-solid fa-floppy-disk"></i> <span style="margin-left:8px">Guardar</span></a>',c+="</div>",c+="</div>",c+="</form>",document.getElementById("dibujar-js").innerHTML=c}async function eliminarUsuario(e){const a=usuarios.find(a=>a.id==e);Swal.fire({title:"ELIMINAR",text:`Eliminar de forma permamente a ${a.nombre}?`,icon:"warning",showCancelButton:!0,confirmButtonText:"Eliminar",confirmButtonColor:"#dc3545"}).then(a=>{a.isConfirmed&&$.ajax({data:{id:e},url:URL_BASE+"/user/delete",type:"POST",headers:{token:token},dataType:"json"}).done(e=>{e.exito?Swal.fire({position:"top-end",icon:"success",title:e.exito,showConfirmButton:!1,timer:1500}).then(()=>{window.location.href=URL_BASE+"/admin"}):e.error?(Swal.fire("ERROR","error",e.error),crearUsuario()):e.exit&&Swal.fire({icon:"warning",title:e.exit,showConfirmButton:!1,text:"Sesión expirada, vuelva a iniciar sesión",timer:3e3}).then(()=>{window.location.href=URL_BASE+"/?r=8"})}).fail(e=>{console.log(e)})})}function llenarPass(){document.getElementById("btnBlock").addEventListener("click",liberarBoton())}function liberarBoton(){const e=document.getElementById("password");1==e.disabled?(e.disabled=!1,e.classList.remove("noallow")):(e.disabled=!0,e.classList.add("noallow"))}async function guardarDatos(e){let a,{nombre:t,apellido:o,cedula:i,celular:n,email:s,password:r,idUnidad:l,idRol:d}=user;t=document.getElementById("nombre").value,o=document.getElementById("apellido").value,i=document.getElementById("cedula").value,n=document.getElementById("celular").value,s=document.getElementById("email").value,1==e&&(r=document.getElementById("password").value,1==document.getElementById("password").disabled&&(r=document.getElementById("cedula").value)),l=document.getElementById("unidad").value,d=document.getElementById("rol").value,a=o.length>0?t+" "+o:t;const c=new FormData;if(2==e){let e=document.getElementById("idUser").value;c.append("id",e)}let u;c.append("nombre",a),c.append("apellido",o),c.append("cedula",i),c.append("celular",n),c.append("email",s),1==e&&(i==r?c.append("passwordCedula",1):c.append("passwordCedula",0),c.append("password",r)),c.append("idUnidad",l),c.append("idRol",d),1==e?u=URL_BASE+"/user/create":2==e&&(u=URL_BASE+"/user/update");const m=await fetch(u,{method:"POST",headers:{token:token},body:c}),p=await m.json();var b="";p.exito?Swal.fire({position:"top-end",icon:"success",title:p.exito,showConfirmButton:!1,timer:1500}).then(()=>{window.location.href=URL_BASE+"/admin"}):p.error?Swal.fire({icon:"error",title:"ERROR",text:p.error}).then(()=>{crearUsuario()}):p.exit?Swal.fire({icon:"warning",title:p.exit,showConfirmButton:!1,text:"Sesión expirada, vuelva a iniciar sesión",timer:3e3}).then(()=>{window.location.href=URL_BASE+"/?r=8"}):(b+='<ul class="alert bg-white px-5 mt-3" style="border-radius:5px;border:1px solid red"  style="width:100%" >',p.alertas.error.forEach(e=>{b+='<li class="text-danger"  >',b+=e,b+="</li>"}),b+="</ul>",document.getElementById("alertas").innerHTML=b),alertas()}function estado(e,a=1){$.ajax({data:{id:e},url:URL_BASE+"/user/estado",type:"POST",headers:{token:token},dataType:"json"}).done(e=>{e.activo?Swal.fire({position:"top-end",icon:"success",title:e.activo,showConfirmButton:!1,timer:1500}).then(()=>{console.log("activo"),console.log("tipo",a),traerUser(a)}):e.inactivo?Swal.fire({position:"top-end",icon:"error",title:e.inactivo,showConfirmButton:!1,timer:1500}).then(()=>{console.log("activo"),console.log("tipo",a),traerUser(a)}):e.exit?Swal.fire({icon:"warning",title:e.exit,showConfirmButton:!1,text:"Sesión expirada, vuelva a iniciar sesión",timer:3e3}).then(()=>{window.location.href=URL_BASE+"/?r=8"}):Swal.fire({icon:"error",title:"ERROR",text:e.error}).then(()=>{traerUser(a)})}).fail(e=>{console.log(e)})}function buscarUsuario(){document.getElementById("dibujar-js").innerHTML='<div class="contenedor-crearUsuario bg-light mb-4"><h3 class="text-black">Ingrese los datos para buscar al usuario</h3><div class="mb-3"><label for="exampleFormControlInput1" class="form-label"><strong>Buscar por:</strong></label><select class="form-select selectDocumentos" name="tipo" id="tipo" onchange="elegirTipo()"><option value="" selected disabled> --  Seleccione una opción -- </option><option value="1">Nombre</option><option value="2">Rol</option><option value="3">Unidad</option></select></div><div id="elegir"></div></div><div id="tablaBuscar"></div></div>'}function elegirTipo(){let e=document.getElementById("tipo").value;var a="";if(e)switch(e){case"1":a+='<div class="mb-3">',a+='<label for="exampleFormControlInput1" class="form-label"><strong>Ingrese el nombre:</strong></label>',a+='<input type="text" class="form-control buscar" placeholder="" aria-label="Username" aria-describedby="basic-addon1" onKeyUp="escucharNombre(this.value)">',a+="</div>",document.getElementById("elegir").innerHTML=a,document.getElementById("tablaBuscar").innerHTML="";break;case"2":a+='<div class="mb-3">',a+='<label for="exampleFormControlInput1" class="form-label"><strong>Buscar por rol:</strong></label>',a+='<select class="form-select" name="rol" id="rol" onchange="escucharRol()">',a+='<option value="" selected disabled> --  Seleccione una opción --</option>',roles.forEach(e=>{a+='<option value="'+e.id+'">'+e.rol+"</option>"}),a+="</select>",a+="</div>",document.getElementById("elegir").innerHTML=a,document.getElementById("tablaBuscar").innerHTML="";break;case"3":a+='<div class="mb-3">',a+='<label for="exampleFormControlInput1" class="form-label"><strong>Buscar por Unidad:</strong></label>',a+='<select class="form-select" name="unidad" id="unidad" onchange="escucharUnidad()">',a+='<option value="" selected disabled> --  Seleccione una opción --</option>',unidades.forEach(e=>{a+='<option value="'+e.id+'">'+e.unidad+"</option>"}),a+="</select>",a+="</div>",document.getElementById("elegir").innerHTML=a,document.getElementById("tablaBuscar").innerHTML=""}}function buscarSeccion(){return new Promise((e,a)=>{let t=[];$.ajax({url:URL_BASE+"/user/seccion",type:"GET",headers:{token:token},dataType:"json"}).done(a=>{a.exit&&Swal.fire({icon:"warning",title:a.exit,showConfirmButton:!1,text:"Sesión expirada, vuelva a iniciar sesión",timer:3e3}).then(()=>{window.location.href=URL_BASE+"/?r=8"}),$.each(a,(o,i)=>{t.push(i),a.length==o+1&&e(t)})}).fail(e=>{a(e)})})}escucharNombre=e=>{$.ajax({data:{tipo:"buscarNombre",dato:e},url:URL_BASE+"/user/buscar",type:"POST",headers:{token:token},dataType:"json"}).done(a=>{var t="";if(0!=e.length){if(a.error)return t+="<div class='w-100 d-flex justify-content-center align-items-center' style='height:200px'> <div class='bg-danger d-flex justify-content-center align-items-center w-100' style='border-radius:5px;height:40px'><h4 class='card-title text-white' style='text-transform: uppercase'>No existen coincidencias</h4></div></div>",void(document.getElementById("tablaBuscar").innerHTML=t);a.exit&&Swal.fire({icon:"warning",title:a.exit,showConfirmButton:!1,text:"Sesión expirada, vuelva a iniciar sesión",timer:3e3}).then(()=>{window.location.href=URL_BASE+"/?r=8"}),localStorage.setItem("buscarUser",JSON.stringify(a)),dibujarUsuarios("tablaBuscar",2,a)}else document.getElementById("tablaBuscar").innerHTML=""}).fail(e=>{console.log(e)})},escucharRol=()=>{let e=document.getElementById("rol").value;$.ajax({data:{tipo:"buscarRol",dato:e},url:URL_BASE+"/user/buscar",type:"POST",headers:{token:token},dataType:"json"}).done(e=>{var a="";if(e.error)return a+="<div class='w-100 d-flex justify-content-center align-items-center' style='height:200px'> <div class='bg-danger d-flex justify-content-center align-items-center w-100' style='border-radius:5px;height:40px'><h4 class='card-title text-white' style='text-transform: uppercase'>No existen coincidencias</h4></div></div>",void(document.getElementById("tablaBuscar").innerHTML=a);e.exit&&Swal.fire({icon:"warning",title:e.exit,showConfirmButton:!1,text:"Sesión expirada, vuelva a iniciar sesión",timer:3e3}).then(()=>{window.location.href=URL_BASE+"/?r=8"}),localStorage.setItem("buscarUser",JSON.stringify(e)),dibujarUsuarios("tablaBuscar",2,e)}).fail(e=>{console.log(e)})},escucharUnidad=()=>{let e=document.getElementById("unidad").value;$.ajax({data:{tipo:"buscarUnidad",dato:e},url:URL_BASE+"/user/buscar",type:"POST",headers:{token:token},dataType:"json"}).done(e=>{var a="";if(e.error)return a+="<div class='w-100 d-flex justify-content-center align-items-center' style='height:200px'> <div class='bg-danger d-flex justify-content-center align-items-center w-100' style='border-radius:5px;height:40px'><h4 class='card-title text-white' style='text-transform: uppercase'>No existen coincidencias</h4></div></div>",void(document.getElementById("tablaBuscar").innerHTML=a);e.exit&&Swal.fire({icon:"warning",title:e.exit,showConfirmButton:!1,text:"Sesión expirada, vuelva a iniciar sesión",timer:3e3}).then(()=>{window.location.href=URL_BASE+"/?r=8"}),localStorage.setItem("buscarUser",JSON.stringify(e)),dibujarUsuarios("tablaBuscar",2,e)}).fail(e=>{console.log(e)})};