const URL_BASE="http://localhost/gdagmcp",CARPETA_BASE="/base",token=JSON.parse(localStorage.getItem("token"));let unidades,secciones,roles;var configDocs={saveBoton:!1,mostrarAllDocs:!1,valuesInputMover:[]};async function iniciarApp(){const e=window.location.search,t=new URLSearchParams(e);var a=t.get("id"),o=t.get("a");console.log("alerta",o),console.log("id",a),await dibujarPadreAndCarpetas(a),o&&mostrarAlerta()}function alertas(){const e=document.querySelectorAll(".alert"),t=document.getElementById("alertas"),a=document.querySelector("#alertaTipo");e&&setTimeout(()=>{e.forEach((function(e){e.remove(),t&&(t.innerHTML=""),a&&(a.innerHTML="")}))},3e3)}function mostrarAlerta(){Swal.fire({icon:"warning",title:"Error",showConfirmButton:!0,text:"La Carpeta no existe"}).then(()=>{window.location.href=URL_BASE+"/carpeta?id=0"})}function traerSeccion(e){return new Promise((t,a)=>{$.ajax({data:{tipo:"findCarpeta",id:e},url:URL_BASE+"/carpeta/datos",type:"POST",headers:{token:token},dataType:"json"}).done(e=>{e.exit&&Swal.fire({icon:"warning",title:e.exit,showConfirmButton:!1,text:"Sesión expirada, vuelva a iniciar sesión",timer:3e3}).then(()=>{window.location.href=URL_BASE+"/?r=8"}),t(e)}).fail(e=>{a(e)})})}function traerSecciones(){return new Promise((e,t)=>{let a=[];$.ajax({data:{tipo:"seccion"},url:URL_BASE+"/carpeta/datos",type:"POST",headers:{token:token},dataType:"json"}).done(t=>{t.exit&&Swal.fire({icon:"warning",title:t.exit,showConfirmButton:!1,text:"Sesión expirada, vuelva a iniciar sesión",timer:3e3}).then(()=>{window.location.href=URL_BASE+"/?r=8"}),0==t.length&&e(a),$.each(t,(o,i)=>{a.push(i),t.length==o+1&&e(a)})}).fail(e=>{t(e)})})}function traerFormularios(){return new Promise((e,t)=>{let a=[];$.ajax({data:{tipo:"formularios"},url:URL_BASE+"/documento/datos",type:"POST",headers:{token:token},dataType:"json"}).done(t=>{t.exit&&Swal.fire({icon:"warning",title:t.exit,showConfirmButton:!1,text:"Sesión expirada, vuelva a iniciar sesión",timer:3e3}).then(()=>{window.location.href=URL_BASE+"/?r=8"}),0==t.length&&e(a),$.each(t,(o,i)=>{a.push(i),t.length==o+1&&e(a)})}).fail(e=>{t(e)})})}function traerFormulario(e){return new Promise((t,a)=>{$.ajax({data:{tipo:"formulario",id:e},url:URL_BASE+"/documento/datos",type:"POST",headers:{token:token},dataType:"json"}).done(e=>{e.exit&&Swal.fire({icon:"warning",title:e.exit,showConfirmButton:!1,text:"Sesión expirada, vuelva a iniciar sesión",timer:3e3}).then(()=>{window.location.href=URL_BASE+"/?r=8"}),t(e)}).fail(e=>{a(e)})})}function traerDocs(e){return new Promise((t,a)=>{let o=[];$.ajax({data:{id:e,tipo:"documentos"},url:URL_BASE+"/carpeta/datos",type:"POST",headers:{token:token},dataType:"json"}).done(e=>{e.exit&&Swal.fire({icon:"warning",title:e.exit,showConfirmButton:!1,text:"Sesión expirada, vuelva a iniciar sesión",timer:3e3}).then(()=>{window.location.href=URL_BASE+"/?r=8"}),0==e.length&&t(0),$.each(e,(a,i)=>{o.push(i),e.length==a+1&&t(o)})}).fail(e=>{a(e)})})}function traerDocumento(e){return new Promise((t,a)=>{$.ajax({data:{id:e,tipo:"documento"},url:URL_BASE+"/documento/datos",type:"POST",headers:{token:token},dataType:"json"}).done(e=>{e.exit&&Swal.fire({icon:"warning",title:e.exit,showConfirmButton:!1,text:"Sesión expirada, vuelva a iniciar sesión",timer:3e3}).then(()=>{window.location.href=URL_BASE+"/?r=8"}),0==e.length&&t(0),$.each(e,(e,a)=>{t(a)})}).fail(e=>{a(e)})})}function traerHijos(e=0){return new Promise((t,a)=>{let o=[];$.ajax({data:{id:e,tipo:"hijos"},url:URL_BASE+"/carpeta/datos",type:"POST",headers:{token:token},dataType:"json"}).done(e=>{e.exit&&Swal.fire({icon:"warning",title:e.exit,showConfirmButton:!1,text:"Sesión expirada, vuelva a iniciar sesión",timer:3e3}).then(()=>{window.location.href=URL_BASE+"/?r=8"}),0==e.length&&t(o),$.each(e,(a,i)=>{o.push(i),e.length==a+1&&t(o)})}).fail(e=>{a(e)})})}function traerHistorial(e){return new Promise((t,a)=>{let o=[];$.ajax({data:{idSeccion:e,tipo:"historial"},url:URL_BASE+"/carpeta/datos",type:"POST",headers:{token:token},dataType:"json"}).done(e=>{e.exit&&Swal.fire({icon:"warning",title:e.exit,showConfirmButton:!1,text:"Sesión expirada, vuelva a iniciar sesión",timer:3e3}).then(()=>{window.location.href=URL_BASE+"/?r=8"}),0==e.length&&t(o),$.each(e,(a,i)=>{o.push(i),e.length==a+1&&t(o)})}).fail(e=>{a(e)})})}function traerHistorialDocCarpeta(e){return new Promise((t,a)=>{let o=[];$.ajax({data:{idSeccion:e,tipo:"historial"},url:URL_BASE+"/documento/datos",type:"POST",headers:{token:token},dataType:"json"}).done(e=>{e.exit&&Swal.fire({icon:"warning",title:e.exit,showConfirmButton:!1,text:"Sesión expirada, vuelva a iniciar sesión",timer:3e3}).then(()=>{window.location.href=URL_BASE+"/?r=8"}),0==e.length&&t(o),$.each(e,(a,i)=>{o.push(i),e.length==a+1&&t(o)})}).fail(e=>{a(e)})})}function traerHistorialDoc(e){return new Promise((t,a)=>{let o=[];$.ajax({data:{idDoc:e,tipo:"historialByDoc"},url:URL_BASE+"/documento/datos",type:"POST",headers:{token:token},dataType:"json"}).done(e=>{e.exit&&Swal.fire({icon:"warning",title:e.exit,showConfirmButton:!1,text:"Sesión expirada, vuelva a iniciar sesión",timer:3e3}).then(()=>{window.location.href=URL_BASE+"/?r=8"}),0==e.length&&t(o),$.each(e,(a,i)=>{o.push(i),e.length==a+1&&t(o)})}).fail(e=>{a(e)})})}function moverCarpeta(e){return new Promise((t,a)=>{let o=[];$.ajax({data:{id:e,tipo:"updateCarpetas"},url:URL_BASE+"/carpeta/datos",type:"POST",headers:{token:token},dataType:"json"}).done(e=>{e.exit&&Swal.fire({icon:"warning",title:e.exit,showConfirmButton:!1,text:"Sesión expirada, vuelva a iniciar sesión",timer:3e3}).then(()=>{window.location.href=URL_BASE+"/?r=8"}),0==e.length&&t(o),$.each(e,(a,i)=>{o.push(i),e.length==a+1&&t(o)})}).fail(e=>{a(e)})})}function traerDocsMover(e){return new Promise((t,a)=>{let o=[];$.ajax({data:{id:e,tipo:"allDocs"},url:URL_BASE+"/carpeta/datos",type:"POST",headers:{token:token},dataType:"json"}).done(e=>{e.exit&&Swal.fire({icon:"warning",title:e.exit,showConfirmButton:!1,text:"Sesión expirada, vuelva a iniciar sesión",timer:3e3}).then(()=>{window.location.href=URL_BASE+"/?r=8"}),0==e.length&&t(0),$.each(e,(a,i)=>{o.push(i),e.length==a+1&&t(o)})}).fail(e=>{a(e)})})}async function dibujarAtras(e){dibujarPadreAndCarpetas((await traerSeccion(e)).idPadre)}function hexToRgb(e){const t=e.match(/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})$/i);if(t)return t.slice(1).map(e=>parseInt(e,16));const a=e.match(/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i);return a?a.slice(1).map(e=>17*parseInt(e,16)):0}function buscarCarpeta(e){document.getElementById("divBtnBuscar").innerHTML="",console.log("seecionActual",e);var t="";t+='<div class=" d-flex  justify-content-end" >',t+='<input style="width:193.5px;height:32.3px" class="form-control" id="buscarFocus" type="text" placeholder="Ingrese nombre de carpeta" onKeyUp="escucharCarpeta(this.value,'+(null!=e?e:0)+')">',t+="</div>",document.getElementById("divBtnBuscar").innerHTML=t,document.getElementById("buscarFocus").focus()}async function dibujarPadreAndCarpetas(e){await dibujarPadre(e),await dibujarHijosPadre(e),configDocs={saveBoton:!1,mostrarAllDocs:!1,valuesInputMover:[]}}async function dibujarPath(e,t){"base"!=e?$.ajax({data:{tipo:"buscarPath",value:e.replace("_"," "),id:t},url:URL_BASE+"/carpeta/datos",type:"POST",headers:{token:token},dataType:"json"}).done(e=>{e.exit&&Swal.fire({icon:"warning",title:e.exit,showConfirmButton:!1,text:"Sesión expirada, vuelva a iniciar sesión",timer:3e3}).then(()=>{window.location.href=URL_BASE+"/?r=8"}),e.forEach(e=>{window.location.href=URL_BASE+"/carpeta?id="+e.id})}).fail(e=>{console.log(e)}):window.location.href=URL_BASE+"/carpeta?id=0"}async function dibujarPadre(e){var t="";let a,o=await traerSeccion(e),i=await traerHistorial(e);if(a=0==o?0:o.idPadre,t+='<div class="d-flex justify-content-center padreAtras">',t+='<div class="d-flex justify-content-center hijoAtras">',t+='<a class=" btn btn-outline-danger '+(0==o?"noVisible":"")+' " href="'+URL_BASE+"/carpeta?id="+a+'"><i class="fa-solid fa-arrow-left-long fa-2x"></i> <span class="span-boton">Atrás</span></a>',t+="</div>",0==o?t+='<h1 class="text-black "><strong>Administrar Carpetas</strong></h1>':(t+='<div class="d-flex flex-column justify-content-center">',t+='<div class="d-flex justify-content-center align-items-center">',t+='<i class="fa-solid fa-folder-open fa-xl" style="margin-right:7px;font-size:35px;color:'+o.color+'"></i>',t+='<div class="d-flex justify-content-center align-items-center">',t+='<h1 class="text-black m-0 p-0"><strong>'+(o.seccion[0].toUpperCase()+o.seccion.substring(1))+"</strong></h1>",t+="</div>",t+='<div class="d-flex justify-content-center align-items-center mb-2" style="margin-left:5px">',t+='<button type="button" class="btn btn-outline-secondary dropdown-toggle py-0" data-bs-toggle="dropdown" style="width:25px;height:30px;border:none">',t+='<i class="fa-solid fa-ellipsis-vertical" style="font-size:25px"></i>',t+="</button>",t+='<ul class="dropdown-menu dropdown-menu-dark">',t+=' <li class="puntero"><a class="dropdown-item" data-bs-toggle="modal" data-bs-target="#exampleModalEditar'+o.id+'"><i class="fa-solid fa-pen-to-square" style="margin-right:7px"></i>Editar</a></li>',t+=' <li class="puntero"><a class="dropdown-item" data-bs-toggle="modal" data-bs-target="#exampleModalInfo'+o.id+'"><i class="fa-solid fa-circle-info" style="margin-right:7px"></i>Información</a></li>',t+='<li class="puntero"><a class="dropdown-item" onclick="deleteSeccion('+o.id+')"><i class="fa-solid fa-trash" style="margin-right:7px"></i>Eliminar</a></li>',t+="</ul>",t+="</div>",t+="</div>",o.descripcion.length>0?t+='<h3 class="text-black mt-3 mb-4">'+(o.descripcion[0].toUpperCase()+o.descripcion.substring(1))+"</h3>":t+='<h3 class="text-black mt-3 mb-4">'+o.descripcion+"</h3>",t+="</div>"),t+="</div>",t+='<div class="d-flex justify-content-end mt-2">',t+='<div style="margin-right:5px" id="divBtnBuscar">',t+='<a class="btn btn-outline-primary" onclick="buscarCarpeta('+(0!=o?o.id:0)+')"><i class="fa-solid fa-magnifying-glass fa-2x"></i><span class="span-boton">Carpeta</span></a>',t+="</div>",t+="<div>",t+='<a class=" btn btn-primary"  data-bs-toggle="modal" data-bs-target="#exampleModal'+e+'" id="'+e+'"><i class="fa-solid fa-plus fa-2x"></i><span class="span-boton">Carpeta</span></a>',t+="</div>",t+="</div>",t+='<div class="w-100 mt-2">',0!=o){JSON.parse(o.pathLink).forEach(e=>{console.log("paths",e);var a=e.seccion.replaceAll("_"," ");t+=`<a class="puntero" style="text-decoration: none !important;" href="${URL_BASE}/carpeta?id=${e.id}")"><strong>`+(a[0].toUpperCase()+a.substring(1))+"</strong></a> /  "})}if(t+="</div>",t+='<div class="contenedor-carpetas mt-3 mb-5" id="contenedorCarpetas" >',t+="</div>",t+='<div class="modal fade" id="exampleModal'+e+'" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">',t+='<div class="modal-dialog">',t+='<div class="modal-content">',t+='  <div class="modal-header bg-black">',t+=0==o?'   <h5 class="modal-title text-white">Crear Carpeta</h5>':'   <h5 class="modal-title text-white">Agregar Carpeta en '+(o.seccion[0].toUpperCase()+o.seccion.substring(1))+"</h5>",t+='<button type="button" class="btn text-white" style="font-size:11px" data-bs-dismiss="modal" aria-label="Close"><i class="fa-solid fa-x fa-lg"></i></button>',t+="  </div>",t+='  <div class="modal-body">',t+='<h3 class="text-black mt-2 mb-4">Ingresar Datos</h3>',t+='<div class="mb-3">',t+='<label  class="form-label"><strong>Nombre:</strong></label>',t+='<input type="text" class="form-control" id="seccion" name="seccion" placeholder="Ingrese nombre">',t+="</div>",t+='<div class="mb-2">',t+='<label  class="form-label"><strong>Descripción:</strong></label>',t+='<textarea class="form-control" rows="5" id="descripcion" placeholder="Ingrese descripción"></textarea>',t+="</div>",t+='<div class="mb-3">',t+='<label  class="form-label"><strong>Color:</strong></label>',t+='<input type="color" class="form-control w-25" id="color" name="color">',t+="</div>",t+='<div class="w-100 mt-2" id="alertas">',t+="</div>",t+="</div>",t+='<div class="modal-footer">',t+='<button type="button" class="btn btn-outline-danger" data-bs-dismiss="modal">Cancelar</button>',t+=0==o?'<a class="btn btn-success" id="botonCrear" onclick="createSeccion(0)"><i class="fa-solid fa-floppy-disk"></i> <span style="margin-left:8px">Guardar</span></a>':'<a class="btn btn-success" id="botonCrear" onclick="createSeccion('+e+')"><i class="fa-solid fa-floppy-disk"></i> <span style="margin-left:8px">Guardar</span></a>',t+="</div>",t+="</div>",t+="</div>",t+="</div>",!1!==o){t+='<div class="modal fade" id="exampleModalEditar'+o.id+'" tabindex="-1" aria-labelledby="exampleModalLabel'+o.id+'" aria-hidden="true">',t+='<div class="modal-dialog">',t+='<div class="modal-content">',t+='  <div class="modal-header bg-black">',t+='   <h5 class="modal-title text-white">Editar</h5>',t+='<button type="button" class="btn text-white" style="font-size:11px" data-bs-dismiss="modal" aria-label="Close"><i class="fa-solid fa-x fa-lg"></i></button>',t+="  </div>",t+='  <div class="modal-body" style="min-height:350px">',t+='<h3 class="text-black mt-2 mb-4">Edite <strong>'+o.seccion+"</strong></h3>",t+='<div class="mb-4 d-flex justify-content-between">',t+='<div class="d-flex flex-column" style="width:70%">',t+='<label  class="form-label"><strong>Nombre:</strong></label>',t+='<input type="text" class="form-control" id="seccion'+o.id+'" value="'+o.seccion+'">',t+="</div>",t+='<div class="d-flex flex-column" style="width:28%">',t+='<label class="form-label"><strong>Color:</strong></label>',t+='<input type="color" class="form-control  puntero" id="color'+o.id+'" value="'+o.color+'">',t+="</div>",t+="</div>",t+='<div class="mb-4">',t+='<label for="exampleFormControlInput1" class="form-label"><strong>Descripción:</strong></label>',""==o.descripcion?t+='<textarea class="form-control" rows="6" id="descripcion'+o.id+'" placeholder="Esta Sección no tiene descripción"></textarea>':t+='<textarea class="form-control" rows="6" id="descripcion'+o.id+'" >'+o.descripcion+"</textarea>",t+="</div>",t+='<div class="mb-4">',t+='<div class="w-100">',t+='<label class="form-label"><strong>Mover Carpeta:</strong></label>',t+="</div>",t+='<div style="height:30px">',t+='<select style="width:100%;height:100% !important" id="select'+o.id+'" class="js-example-basic-single" >';const a={id:"0",idPadre:"0",seccion:"CARPETA BASE",descripcion:"",color:"#000000",path:"/base"};let s=JSON.parse(o.carpetas);s.unshift(a),s.forEach(e=>{e.id!=o.id&&(t+='<optgroup label="'+e.seccion+'">',t+='<option value="'+e.id+'" '+(e.id==o.idPadre?"selected":"")+'><strong><i class="fa-solid fa-folder-open"></i></strong>'+e.path+"</option>",t+="</optgroup>")}),t+="</select>",t+="</div>",t+='<div class="w-100 mt-4" id="alertas'+o.id+'">',t+="</div>",t+="</div>",t+="</div>",t+='<div class="modal-footer">',t+='<button type="button" class="btn btn-outline-danger" data-bs-dismiss="modal">Cancelar</button>',t+='<a class="btn btn-success" id="botonCrear" onclick="updateSeccion('+o.idPadre+","+o.id+',1)"><i class="fa-solid fa-floppy-disk"></i> <span style="margin-left:8px">Guardar</span></a>',t+="</div>",t+="</div>",t+="</div>",t+="</div>",t+='<div class="modal fade" id="exampleModalInfo'+e+'" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true" >',t+='<div class="modal-dialog modal-lg" style="min-width:800px !important" >',t+='<div class="modal-content">',t+='  <div class="modal-header bg-black">',t+='   <h5 class="modal-title text-white">Información de Carpeta</h5>',t+='<button type="button" class="btn text-white" style="font-size:11px" data-bs-dismiss="modal" aria-label="Close"><i class="fa-solid fa-x fa-lg"></i></button>',t+="  </div>",t+='  <div class="modal-body">',0==o?t+='   <h5 class="modal-title text-white">Modificaciones</h5>':(t+='<div class="d-flex justify-content-between">',t+='<div style="width:160px"></div>',t+='<h3 class="text-black mt-2 mb-4"> <i class="fa-solid fa-folder-open" style="color:'+o.color+'"></i> '+(o.seccion[0].toUpperCase()+o.seccion.substring(1))+"</h3>",t+='<div><button type="button" class="btn btn-warning" style="font-size:13.4px" onclick="historialDocs('+o.id+')"><i class="fa-solid fa-rotate-right fa-flip-horizontal" style="margin-right:5px"></i>Historial Documentos</button></div>',t+="</div>"),t+='<div id="historialDoc">',t+='<table class="table table-hover align-middle" id="tablaUsuarios">',t+='<thead class="table-secondary ">',t+='<tr style="text-transform:uppercase">',t+="<th >#</th>",t+="<th >Usuario</th>",t+="<th >Acción</th>",t+='<th style="width:170px">Carpeta</th>',t+="<th >Fecha</th>",t+="<th  >Detalle</th>",t+="</tr>",t+="</thead>",t+='<tbody class="contenido" id="contenido">',i.forEach((e,a)=>{var o=null!=e.nombreSeccion?e.nombreSeccion:e.seccion;t+=`<tr title="${o[0].toUpperCase()+o.substring(1)}">`,t+=`<td >${a+1}</td>`,t+=`<td style="min-width:112px"> ${null!=e.nombre?e.nombre:e.user}</td>`,t+=`<td class="${"create"==e.accion?"text-success":"delete"==e.accion?"text-danger":"text-primary"}"> ${e.accion[0].toUpperCase()+e.accion.substring(1)}</td>`,t+=`<td >${o[0].toUpperCase()+o.substring(1)}</td>`,t+=`<td style="min-width:172px"> ${e.created_at}</td>`,t+='<td ">',t+='<div class="d-flex justify-content-center dropend">',t+='<button type="button" class="btn btn-outline-secondary dropdown-toggle" data-bs-toggle="dropdown"  style="border-radius:15px;border:0px">',t+='<i class="fa-solid fa-ellipsis-vertical fa-2x"></i>',t+="</button>",t+=' <div class="dropdown-menu dropdown-menu-dark p-4" style="min-width:400px" >',t+='<div class="d-flex" style="font-size:13px">',t+='<div class="d-flex w-100 justify-content-center" style="font-size:13px"><i class="fa-solid fa-folder-open" style="margin-right:5px"></i> <strong>'+(o[0].toUpperCase()+o.substring(1))+"</strong>",t+="</div>",t+="</div>",t+='<div class="row" style="font-size:13px">';var i=JSON.parse(e.data);for(var s in i.new)t+='<div style="display:block;height:auto;">',t+='<div style="min-width:100px"><strong>'+(s[0].toUpperCase()+s.substring(1))+":</strong></div>",t+='<div > <span class="text-info">New </span> => '+(null!=i.new[s]?i.new[s]:"null")+"</div>",t+='<div > <span class="text-warning">Old </span> => '+(null!=i.old[s]?i.old[s]:"null")+"</div>",t+="</div>";t+="</div>",t+="</div>",t+="</td>",t+="</tr>"}),t+="</tbody>",t+="</table>",t+="</div>",t+='<div class="w-100 mt-2" id="alertas">',t+="</div>",t+="</div>",t+='<div class="modal-footer">',t+='<button type="button" class="btn btn-outline-danger" data-bs-dismiss="modal">Cancelar</button>',t+="</div>",t+="</div>",t+="</div>",t+="</div>"}document.getElementById("dibujar-js").innerHTML=t,document.getElementById("dibujar-tabla").innerHTML="",waitResponse("#contenedorCarpetas"),e>0&&await dibujarDocs(e),$("#select"+e).select2({dropdownParent:$("#exampleModalEditar"+e)}),$("#tablaUsuarios").DataTable({columnDefs:[{targets:[5],searchable:!1}],language:{url:URL_BASE+"/public/build/js/varios/DataTable_es_es.json"}})}async function dibujarHijosPadre(e,t=[]){let a="";a=t.length>0?t:await traerHijos(e);var o="";0===a.length?(o+='<div class="px-5 py-2 mt-3 w-100 ">',o+='<div class="d-flex justify-content-center align-items-center">',o+='<h4 class="" style="color:red">No Existen Carpetas</h4>',o+="</div>",o+="</div>"):(o+='<div class="d-flex justify-content-center " style="flex-wrap:wrap">',a.forEach(t=>{o+='<div class="p-3 padreCarpeta">',o+='<a class="btn hoverCarpeta" style="border:1px solid #e2e4e6"  href="'+URL_BASE+"/carpeta?id="+t.id+'">',o+='<div class="row justify-content-center align-items-center  widthCarpeta ">',o+='<div class="">',o+='<i class="fa-regular fa-folder-open" style="font-size:40px;margin-bottom:10px;color:'+t.color+'"></i>',o+='<div style="margin-bottom:-7px">',o+='<p style="font-weight:bold">'+(t.seccion[0].toUpperCase()+t.seccion.substring(1))+"</p>",o+="</div>",o+="</div>",o+="</div>",o+="</a>",o+='<div class="d-flex justify-content-center align-items-center elip">',o+='<buttom class="btn btn-outline-secondary botonesCarpeta btn-hover dropdown-toggle py-2 px-3"  style="border:none" data-bs-toggle="dropdown" aria-expanded="false" type="buttom">',o+='<i class="fa-solid fa-ellipsis-vertical fa-xl elip" ></i>',o+="</buttom>",o+='<ul class="dropdown-menu dropdown-menu-dark">',o+='<li class="puntero"><a class="dropdown-item" data-bs-toggle="modal" data-bs-target="#exampleModal'+t.id+'"><i class="fa-solid fa-pen-to-square" style="margin-right:7px"></i>Editar</a></li>',o+='<li class="puntero"><a class="dropdown-item" onclick="deleteSeccion('+t.id+')"><i class="fa-solid fa-trash" style="margin-right:7px"></i>Eliminar</a></li>',o+=" </ul>",o+="</div>",o+="</div>",o+='<div class="modal fade" id="exampleModal'+t.id+'" tabindex="-1" aria-labelledby="exampleModalLabel'+t.id+'" aria-hidden="true">',o+='<div class="modal-dialog">',o+='<div class="modal-content">',o+='  <div class="modal-header bg-black">',o+='   <h5 class="modal-title text-white">Editar</h5>',o+='<button type="button" class="btn text-white" style="font-size:11px" data-bs-dismiss="modal" aria-label="Close"><i class="fa-solid fa-x fa-lg"></i></button>',o+="  </div>",o+='  <div class="modal-body" style="min-height:350px">',o+='<h3 class="text-black mt-2 mb-4">Edite <strong>'+t.seccion+"</strong></h3>",o+='<div class="mb-4 d-flex justify-content-between">',o+='<div class="d-flex flex-column" style="width:70%">',o+='<label  class="form-label"><strong>Nombre:</strong></label>',o+='<input type="text" class="form-control" id="seccion'+t.id+'" value="'+t.seccion+'">',o+="</div>",o+='<div class="d-flex flex-column" style="width:28%">',o+='<label class="form-label"><strong>Color:</strong></label>',o+='<input type="color" class="form-control  puntero" id="color'+t.id+'" value="'+t.color+'">',o+="</div>",o+="</div>",o+='<div class="mb-4">',o+='<label for="exampleFormControlInput1" class="form-label"><strong>Descripción:</strong></label>',""==t.descripcion?o+='<textarea class="form-control" rows="6" id="descripcion'+t.id+'" placeholder="Esta Sección no tiene descripción"></textarea>':o+='<textarea class="form-control" rows="6" id="descripcion'+t.id+'" >'+t.descripcion+"</textarea>",o+="</div>",o+='<div class="mb-4">',o+='<div class="w-100">',o+='<label class="form-label"><strong>Mover Carpeta:</strong></label>',o+="</div>",o+='<div style="height:30px">',o+='<select style="width:100%;height:100% !important" id="select'+t.id+'" class="js-example-basic-single" >';let a=JSON.parse(t.carpetas);a.unshift({id:"0",idPadre:"0",seccion:"CARPETA BASE",descripcion:"",color:"#000000",path:"/base"}),a.forEach(a=>{a.id!=t.id&&(o+='<optgroup label="'+a.seccion+'">',o+='<option value="'+a.id+'" '+(a.id==e?"selected":"")+'><strong><i class="fa-solid fa-folder-open"></i></strong>'+a.path+"</option>",o+="</optgroup>")}),o+="</select>",o+="</div>",o+='<div class="w-100 mt-4" id="alertas'+t.id+'">',o+="</div>",o+="</div>",o+="</div>",o+='<div class="modal-footer">',o+='<button type="button" class="btn btn-outline-danger" data-bs-dismiss="modal">Cancelar</button>',o+='<a class="btn btn-success" id="botonCrear" onclick="updateSeccion('+e+","+t.id+',2)"><i class="fa-solid fa-floppy-disk"></i> <span style="margin-left:8px">Guardar</span></a>',o+="</div>",o+="</div>",o+="</div>",o+="</div>"}),o+="</div>"),document.getElementById("contenedorCarpetas").innerHTML=o,a.forEach(e=>{$("#select"+e.id).select2({dropdownParent:$("#exampleModal"+e.id)})})}async function dibujarDocs(e,t=[]){let a,o=await traerSeccion(e);a=0==t.length?await traerDocs(e):t;var i="";i+='<div class="accordion" id="accordionExample">',i+='<div class="accordion-item ">',i+='<h2 class="accordion-header" id="headingOne">',i+='<button class="accordion-button '+(a.length>0?"":"collapsed")+' contenedor-carpetas" type="button"  style="height:55px" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne"><div class="d-flex w-100 justify-content-center"><h4 style="color:black">Documentos de<strong> '+o.seccion+"</strong></h4></div></button>",i+=" </h2>",i+='<div id="collapseOne" class="accordion-collapse collapse '+(a.length>0?"show":"")+'" data-bs-parent="#accordionExample">',i+=' <div class="accordion-body px-0">',i+='<div class="" id="botonesDoc">',i+='<div class="d-flex mb-3 justify-content-end">',i+='<a title="Mover Documentos" class="btn btn-outline-primary" style="margin-right:4px" id="moverDocs"  onclick="moverDocumentos('+e+',0)"><i class="fa-solid fa-square-check fa-2x"></i></a>',i+='<a title="Ver todos los Documentos" class="btn btn-primary" style="margin-right:4px" id="mostrarDocs"  onclick="mostrarDocsPro('+e+')"><i class="fa-regular fa-eye fa-2x"></i></a>',i+='<a class="btn btn-warning"  onclick="agregarDocumento('+e+')"><i class="fa-solid fa-plus fa-2x"></i><span class="span-boton">Documento</span></a>',i+="</div>",i+="</div>",i+='<div class="apagar" id="botonesMover">',i+='<div class="d-flex mb-3 justify-content-end">',i+='<a title="Cancelar" class="btn btn-outline-danger" style="margin-right:4px" id="mostrarDocs"  onclick="moverDocumentos('+e+',0)"><i class="fa-solid fa-ban fa-2x"></i></a>',i+='<buttom title="Mover Seleccionados" class="btn btn-success" onclick="inputsValue('+e+')"  id="moverSelect" ><i class="fa-solid fa-folder-tree fa-2x" style="margin-right:4px"></i><span class="span-boton"> Mover a:</span></buttom>',i+="</div>",i+="</div>",i+='<table class="table" style="min-width:1000px" id="tablaDocsUltimo">',i+='<thead class="table-dark">',i+='<tr class="" style="text-transform:uppercase">',i+='<th style="max-width:40px !important">N°</th>',i+='<th style="min-width:225px !important">Documento</th>',i+='<th class="">Carpeta</th>',i+='<th class="">Form</th>',i+="<th >Datos</th>",i+='<th class="">Responsable</th>',i+="<th >Fecha</th>",i+="<th >Acciones</th>",i+="</tr>",i+="</thead>",i+='<tbody class="contenido docsContenido" id="contenido">',a.length>0&&a.forEach((e,t)=>{i+="<tr>",i+='<td style="max-width:40px !important">'+(parseInt(t)+1)+"</td>",i+="<td>",""==e.alias?i+='<i class="fa-solid fa-file-pdf" style="margin-right:5px"></i>'+e.codigo:i+='<i class="fa-solid fa-file-pdf" style="margin-right:5px"></i>'+e.alias,i+='<button title="Historial" class="btn btn-outline-secondary" style="margin-left:5px;border:none;margin-bottom:7px" onclick="dibujarModalHistorialDoc('+e.id+')"><i class="fa-solid fa-ellipsis-vertical fa-xl"></i></button>',i+="</div>",i+="<td>"+e.seccion+"</td>",i+="<td>"+e.formulario+"</td>",i+='<td><buttom class="btn btn-secondary" style="margin-left:12px" data-bs-toggle="modal" data-bs-target="#exampleModalVer'+e.id+'">Ver</buttom></td>',i+="<td>"+e.responsable+"</td>",i+='<td><div class="row"  style="font-size:14px"><p>'+e.created_at.split(" ")[0]+"</p><p>"+e.created_at.split(" ")[1]+"</p></div></td>",i+="<td >",i+=' <div class="contenedor-opciones">',i+='<div class="d-flex justify-content-center">';const a="'"+e.path+"'",o="'"+e.codigo+"'";i+='<button title="Ver Documento" class="btn btn-outline-primary" style="margin-right:5px;height:30px;" onclick="abrirPdf('+a+","+o+')"><i class="fa-solid fa-file-pdf fa-2x"></i></button>',i+='<button title="Editar" class="btn btn-warning"  data-bs-toggle="modal" data-bs-target="#exampleModalEditar'+e.id+'" style="margin-right:5px;height:30px;"><i class="fa-solid fa-pen-to-square fa-2x"></i></button>',i+='<button title="Eliminar" class="btn btn-outline-danger" style=";height:30px;" onclick="deleteDoc('+e.id+')"><i class="fa-solid fa-trash fa-2x"></i></button>',i+="</div>",i+="</div>",i+='<div class="apagar  contenedor-check">',i+='<div class=" d-flex justify-content-center">',i+='<input class="form-check-input mover" style="margin:0px;margin-left:15px;width:30px;height:30px;border:2px solid #0D6EFD" type="checkbox" value='+e.id+">",i+="</div>",i+="</div>",i+="</td>",i+="</tr>",i+='<div class="modal fade" id="exampleModalVer'+e.id+'" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">',i+=' <div class="modal-dialog modal-dialog-centered">',i+=' <div class="modal-content">',i+=' <div class="modal-header bg-black ">',i+=' <h5 class="modal-title text-white" id="exampleModalLabel">Metadatos Documento <strong>'+e.codigo+"</strong></h5>",i+='<button type="button" class="btn text-white" style="font-size:13px" data-bs-dismiss="modal" aria-label="Close"><i class="fa-solid fa-x fa-lg"></i></button>',i+=" </div>",i+='  <div class="modal-body">';let s=JSON.parse(e.data);i+='<ol class="list-group list-group-numbered" style="font-size:12px">',i+='<li class="list-group-item  d-flex justify-content-between align-items-start">',i+='<div class="ms-2 me-auto">',i+=' <div class="fw-bold mb-2">KEYWORDS</div>',i+=e.keywords,i+=" </div>",i+="</li>",s.forEach(e=>{i+='<li class="list-group-item  d-flex justify-content-between align-items-start">',i+='<div class="ms-2 me-auto">',i+=' <div class="fw-bold mb-2">'+e.nombre.toUpperCase()+"</div>",i+=e.valor,i+=" </div>"}),i+="</ol>",i+="</div>",i+=' <div class="modal-footer d-flex justify-content-between mt-3">',i+=' <p class=""> Ultima modificación: <strong>'+e.updated_at+"</strong></p>",i+=' <button type="button" class="btn btn-outline-danger" data-bs-dismiss="modal">Cerrar</button>',i+="  </div>",i+="</div>",i+="</div>",i+="</div>",i+='<div class="modal fade" id="exampleModalEditar'+e.id+'" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">',i+=' <div class="modal-dialog modal-dialog-centered">',i+=' <div class="modal-content">',i+=' <div class="modal-header bg-black ">',i+=' <h5 class="modal-title text-white" id="exampleModalLabel">Editar Metadatos <strong>'+e.codigo+"</strong></h5>",i+='<button type="button" class="btn text-white" style="font-size:13px" data-bs-dismiss="modal" aria-label="Close"><i class="fa-solid fa-x fa-lg"></i></button>',i+=" </div>",i+='  <div class="modal-body">';let l=JSON.parse(e.data);i+='<div class="mb-4" id="keywords">',i+='<label class="form-label"><strong>KEYWORDS</strong></label>',i+='<textarea class="form-control edit-campos'+e.id+'" rows="3" name="keywords" placeholder="Documento sin palabras claves">'+e.keywords+"</textarea>",i+="</div>",l.forEach(t=>{i+='<div class="mb-4" id="'+t.nombre.trim()+'">',i+='<label class="form-label"><strong>'+t.nombre.toUpperCase()+"</strong></label>",i+='<textarea class="form-control edit-campos'+e.id+'"  rows="4" name="'+t.nombre.trim()+'" placeholder="Sin datos">'+t.valor+"</textarea>",i+="</div>"}),i+='<div class="mb-4" id="alias">',i+='<label class="form-label"><strong>ALIAS</strong></label>',i+='<textarea class="form-control '+e.id+'" rows="2" name="alias" id="aliasDoc" placeholder="Documento sin alias">'+e.alias+"</textarea>",i+="</div>",i+='<div class="w-100 mt-2" id="alertasEditarMetadata'+e.id+'">',i+="</div>",i+="</div>",i+='<div class="modal-footer mt-3 d-flex justify-content-between">',i+='<p class=""> Ultima modificación: <strong>'+e.updated_at+"</strong></p>",i+='<div class="">',i+='<button type="button" style="margin-right:4px" class="btn btn-outline-danger" data-bs-dismiss="modal">Cerrar</button>',i+='<button type="button" class="btn btn-success" onclick="saveEditDoc('+e.id+')"><i class="fa-solid fa-floppy-disk" style="margin-right:3px"></i>Guardar</button>',i+="</div>",i+="</div>",i+="</div>",i+="</div>",i+="</div>"}),i+="</tbody>",i+="</table>",i+="</tbody>",i+=" </div>",i+=" </div>",i+="</div>",i+="</div>",document.getElementById("dibujar-tabla").innerHTML=i,0!==t.length&&document.getElementById("mostrarDocs").classList.add("disabledButtom"),$("#tablaDocsUltimo").DataTable({language:{url:URL_BASE+"/public/build/js/varios/DataTable_es_es.json"}})}async function dibujarModalHistorialDoc(e){var t="";let a=await traerDocumento(e),o=await traerHistorialDoc(e);t+='<div class="modal fade" id="exampleModalHistorialByDoc'+a.id+'" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">',t+=' <div class="modal-dialog modal-lg">',t+=' <div class="modal-content">',t+=' <div class="modal-header bg-black ">',t+=' <h5 class="modal-title text-white" id="exampleModalLabel">Historial Documento <strong>'+a.codigo+"</strong></h5>",t+='<button type="button" class="btn text-white" style="font-size:13px" data-bs-dismiss="modal" aria-label="Close"><i class="fa-solid fa-x fa-lg"></i></button>',t+=" </div>",t+='  <div class="modal-body">',t+='<h3 class="text-black mt-2 mb-4"> <i class="fa-solid fa-file-pdf" "></i> '+(""!=a.alias?a.alias:a.codigo)+"</h3>",t+='<div id="historialDoc">',t+='<table class="table table-hover align-middle" id="tablaHistorialByDoc">',t+='<thead class="table-secondary ">',t+='<tr style="text-transform:uppercase">',t+="<th >#</th>",t+="<th >Usuario</th>",t+="<th >Acción</th>",t+='<th style="width:170px">Carpeta</th>',t+="<th >Fecha</th>",t+="<th  >Detalle</th>",t+="</tr>",t+="</thead>",t+='<tbody class="contenido" id="contenido">',o.forEach((e,a)=>{console.log("dato",e);var o=null!=e.nombreSeccion?e.nombreSeccion:e.seccion;t+=`<tr title="${o[0].toUpperCase()+o.substring(1)}">`,t+=`<td >${a+1}</td>`,t+=`<td style="min-width:112px"> ${null!=e.nombre?e.nombre:e.user}</td>`,t+=`<td class="${"create"==e.accion?"text-success":"delete"==e.accion?"text-danger":"text-primary"}"> ${e.accion[0].toUpperCase()+e.accion.substring(1)}</td>`,t+=`<td >${o[0].toUpperCase()+o.substring(1)}</td>`,t+=`<td style="min-width:172px"> ${e.created_at}</td>`,t+='<td ">',t+='<div class="d-flex justify-content-center dropend">',t+='<button type="button" class="btn btn-outline-secondary dropdown-toggle" data-bs-toggle="dropdown"  style="border-radius:15px;border:0px">',t+='<i class="fa-solid fa-ellipsis-vertical fa-2x"></i>',t+="</button>",t+=' <div class="dropdown-menu dropdown-menu-dark p-4" style="min-width:400px" >',t+='<div class="d-flex" style="font-size:13px">',t+='<div class="d-flex w-100 justify-content-center" style="font-size:13px"><i class="fa-solid fa-file-pdf" style="margin-right:5px"></i> <strong>'+e.documento+"</strong>",t+="</div>",t+="</div>",t+='<div class="row" style="font-size:13px">';var i=JSON.parse(e.data);for(var s in i.new){if(t+='<div style="display:block;height:auto;">',t+='<div style="min-width:100px"><strong>'+(s[0].toUpperCase()+s.substring(1))+":</strong></div>","data"!=s)t+='<div > <span class="text-info">New </span> => '+(null!=i.new[s]?i.new[s]:"null")+"</div>",null!=i.old&&(t+='<div > <span class="text-warning">Old </span> => '+(null!=i.old[s]?i.old[s]:"null")+"</div>");else{var l=JSON.parse(i.new.data);if(t+='<div style="display:block;height:auto;">',null!==i.old)for(let e=0;e<l.length;e++){var n=JSON.parse(i.old.data);t+='<div> <span class="text-info">New => </span>'+(null!=l[e].nombre?l[e].nombre:"null")+"  => "+(null!=l[e].valor?l[e].valor:"null")+"</div>",t+='<div> <span class="text-warning">Old =></span> '+(null!=n[e].nombre?n[e].nombre:"null")+" => "+(null!=n[e].valor?n[e].valor:"null")+"</div>"}else for(let e=0;e<l.length;e++)t+='<div> <span class="text-info">New => </span>'+(null!=l[e].nombre?l[e].nombre:"null")+"  => "+(null!=l[e].valor?l[e].valor:"null")+"</div>";t+="</div>"}t+="</div>"}t+="</div>",t+="</div>",t+="</td>",t+="</tr>"}),t+="</tbody>",t+="</table>",t+="</div>",t+="<div>",t+="</div>",t+=' <div class="modal-footer mt-3">',t+=' <button type="button" class="btn btn-outline-danger" data-bs-dismiss="modal">Cerrar</button>',t+="  </div>",t+="</div>",t+="</div>",t+="</div>",document.getElementById("modales").innerHTML=t,$("#tablaHistorialByDoc").DataTable({columnDefs:[{targets:[5],searchable:!1}],language:{url:URL_BASE+"/public/build/js/varios/DataTable_es_es.json"}}),$("#exampleModalHistorialByDoc"+a.id).modal("show")}async function historialDocs(e){var t="";await waitResponse("#historialDoc","374.5px",2);let a=await traerHistorialDocCarpeta(e);t+='<h3 class="text-black mt-2 mb-4"><strong>HISTORIAL DOCUMENTOS</strong></h3>',t+='<table class="table table-hover align-middle" id="tablaHistorialDocs">',t+='<thead class="table-secondary">',t+='<tr style="text-transform:uppercase">',t+="<th >#</th>",t+="<th >Usuario</th>",t+="<th >Acción</th>",t+='<th style="width:170px">Documento</th>',t+="<th >Fecha</th>",t+="<th  >Detalle</th>",t+="</tr>",t+="</thead>",t+='<tbody class="contenido" id="contenido">',a.forEach((e,a)=>{console.log("dato",e);var o=null!=e.nombreSeccion?e.nombreSeccion:e.seccion;t+=`<tr title="${o[0].toUpperCase()+o.substring(1)}">`,t+=`<td >${a+1}</td>`,t+=`<td style="min-width:112px"> ${null!=e.nombre?e.nombre:e.user}</td>`,t+=`<td class="${"create"==e.accion?"text-success":"delete"==e.accion?"text-danger":"text-primary"}"> ${e.accion[0].toUpperCase()+e.accion.substring(1)}</td>`,t+=`<td >${e.documento}</td>`,t+=`<td style="min-width:172px"> ${e.created_at}</td>`,t+='<td ">',t+='<div class="d-flex justify-content-center dropend">',t+='<button type="button" class="btn btn-outline-secondary dropdown-toggle" data-bs-toggle="dropdown"  style="border-radius:15px;border:0px">',t+='<i class="fa-solid fa-ellipsis-vertical fa-2x"></i>',t+="</button>",t+=' <div class="dropdown-menu dropdown-menu-dark p-4" style="min-width:400px" >',t+='<div class="d-flex" style="font-size:13px">',t+='<div class="d-flex w-100 justify-content-center" style="font-size:13px"><i class="fa-solid fa-file-pdf" style="margin-right:5px"></i> <strong>'+e.documento+"</strong>",t+="</div>",t+="</div>",t+='<div class="row" style="font-size:13px">';var i=JSON.parse(e.data);for(var s in i.new){if(t+='<div style="display:block;height:auto;">',t+='<div style="min-width:100px"><strong>'+(s[0].toUpperCase()+s.substring(1))+":</strong></div>","data"!=s)t+='<div > <span class="text-info">New </span> => '+(null!=i.new[s]?i.new[s]:"null")+"</div>",null!=i.old&&(t+='<div > <span class="text-warning">Old </span> => '+(null!=i.old[s]?i.old[s]:"null")+"</div>");else{var l=JSON.parse(i.new.data);if(t+='<div style="display:block;height:auto;">',null!==i.old)for(let e=0;e<l.length;e++){var n=JSON.parse(i.old.data);t+='<div> <span class="text-info">New => </span>'+(null!=l[e].nombre?l[e].nombre:"null")+"  => "+(null!=l[e].valor?l[e].valor:"null")+"</div>",t+='<div> <span class="text-warning">Old =></span> '+(null!=n[e].nombre?n[e].nombre:"null")+" => "+(null!=n[e].valor?n[e].valor:"null")+"</div>"}else for(let e=0;e<l.length;e++)t+='<div> <span class="text-info">New => </span>'+(null!=l[e].nombre?l[e].nombre:"null")+"  => "+(null!=l[e].valor?l[e].valor:"null")+"</div>";t+="</div>"}t+="</div>"}t+="</div>",t+="</div>",t+="</td>",t+="</tr>"}),t+="</tbody>",t+="</table>",document.getElementById("historialDoc").innerHTML=t,$("#tablaHistorialDocs").DataTable({columnDefs:[{targets:[5],searchable:!1}],language:{url:URL_BASE+"/public/build/js/varios/DataTable_es_es.json"}})}document.addEventListener("DOMContentLoaded",iniciarApp()),escucharCarpeta=(e,t)=>{var a="";$.ajax({data:{tipo:"buscarCarpetas",value:e,id:t},url:URL_BASE+"/carpeta/datos",type:"POST",headers:{token:token},dataType:"json"}).done(e=>{e.exit&&Swal.fire({icon:"warning",title:e.exit,showConfirmButton:!1,text:"Sesión expirada, vuelva a iniciar sesión",timer:3e3}).then(()=>{window.location.href=URL_BASE+"/?r=8"}),0!=e.length?dibujarHijosPadre(t,e):(a+='<div class="px-5 py-2 mt-3 w-100 ">',a+='<div class="d-flex justify-content-center align-items-center">',a+='<h4 class="" style="color:red">No Existen Carpetas</h4>',a+="</div>",a+="</div>",document.getElementById("contenedorCarpetas").innerHTML=a)}).fail(e=>{console.log(e)})};var contInputs=0;async function inputsValue(e){let t=await traerSeccion(e),a=await traerSecciones(),o=await traerDocs(e);1==configDocs.mostrarAllDocs&&(o=await traerDocsMover(e));let i=configDocs.valuesInputMover.map(e=>o.find(t=>t.id==e));var s="";s+='<div class="modal fade" id="exampleModalMover" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">',s+='<div class="modal-dialog modal-lg">',s+='<div class="modal-content">',s+='<div class="modal-header bg-black">',s+='<h5 class="modal-title text-white">Mover Documentos</h5>',s+='<button type="button" class="btn text-white" style="font-size:11px" data-bs-dismiss="modal" aria-label="Close"><i class="fa-solid fa-x fa-lg"></i></button>',s+="</div>",s+='<div class="modal-body">',s+='<h3 class="text-black mt-2 mb-4">Seleccionados <strong>'+i.length+"</strong> "+(i.length>1?"Documentos ":"Documento ")+"de <strong>"+(t.seccion[0].toUpperCase()+t.seccion.substring(1))+"</strong>:</h3>",s+='<div class="my-3 d-flex justify-content-center">',s+='<ul class="list-group w-75" style="font-size:12px">',i.forEach(e=>{s+='<li class="list-group-item"><i class="fa-solid fa-file-pdf fa-xl" style="margin-right:5px"></i> '+(""!=e.alias?e.alias:e.codigo)+"</li>"}),s+="<ul>",s+="</div>",s+='<h4 class="text-black mt-3 mb-4 text-center">Enviar a:</h4>',s+='<div style="height:35px" id="contenedorSelectMover">',s+='<select style="width:100%;height:100% !important" id="selectMover" class="js-example-basic-single" >',a.forEach(t=>{s+='<optgroup label="'+t.seccion+'">',s+='<option value="'+t.id+'" '+(t.id==e?"selected disabled":"")+'><strong><i class="fa-solid fa-folder-open"></i></strong>'+t.path+"</option>",s+="</optgroup>"}),s+=" </select>",s+="</div>",s+='<div class="w-100"  id="alertasMoverDoc">',s+="</div>",s+="</div>",s+='<div class="modal-footer mt-2 d-flex justify-content-end">',s+='<button type="button" class="btn btn-outline-danger" data-bs-dismiss="modal">Cerrar</button>',s+='<button type="button" class="btn btn-success" onclick="saveMoverDocs('+e+')"><i class="fa-solid fa-floppy-disk" style="margin-right:3px"></i>Guardar</button>',s+="</div>",s+="</div>",document.getElementById("modales").innerHTML=s,$("#selectMover").select2({dropdownParent:$("#exampleModalMover")}),i.length>0&&$("#exampleModalMover").modal("show")}async function saveMoverDocs(e){const t=document.getElementById("selectMover").value,a=new FormData;var o="";if(t==e)return document.getElementById("contenedorSelectMover").style="border:0.3px solid red !important;border-radius:5px",o+='<p class="text-danger">No se a elegido una carpeta</p>',document.getElementById("alertasMoverDoc").innerHTML=o,void setTimeout(()=>{document.getElementById("contenedorSelectMover").style="",document.getElementById("alertasMoverDoc").innerHTML=""},3e3);a.append("idSeccionAnterior",e),a.append("idSeccionNueva",t),a.append("documentos",JSON.stringify(configDocs.valuesInputMover)),console.log([...a]);const i=await fetch("http://localhost/gdagmcp/documento/mover",{method:"POST",headers:{token:token},body:a}),s=await i.json();console.log(s),s.exito?Swal.fire({position:"top-end",icon:"success",title:s.exito,showConfirmButton:!1,timer:1500}).then(()=>{$("#exampleModalMover").modal("hide"),dibujarPadreAndCarpetas(s.padre)}):s.error?Swal.fire({icon:"error",title:"ERROR",text:s.error}):s.archivo?Swal.fire({icon:"error",title:"ERROR",text:s.archivo}):s.exit?Swal.fire({icon:"warning",title:s.exit,showConfirmButton:!1,text:"Sesión expirada, vuelva a iniciar sesión",timer:3e3}).then(()=>{window.location.href=URL_BASE+"/?r=8"}):(o+='<ul class="alert bg-white px-5 mt-3" style="border-radius:5px;border:1px solid red"  style="width:100%" >',s.alertas.error.forEach(e=>{o+='<li class="text-danger"  >',o+=e,o+="</li>"}),o+="</ul>",document.getElementById("alertasMoverDoc").innerHTML=o),alertas()}async function moverDocumentos(e=0,t){configDocs.saveBoton=!0,configDocs.valuesInputMover=[],document.getElementById("moverSelect").style=0==t?"cursor:not-allowed;background-color:#6C757D":"",document.getElementById("botonesDoc").classList.toggle("apagar"),document.getElementById("botonesMover").classList.toggle("apagar");const a=document.querySelectorAll(".contenedor-opciones"),o=document.querySelectorAll(".contenedor-check"),i=Array.apply(null,a),s=Array.apply(null,o);for(let e=0;e<i.length;e++)s[e].classList.toggle("apagar"),i[e].classList.toggle("apagar");let l=document.querySelectorAll(".mover");Array.apply(null,l).forEach(e=>{1==e.checked&&(e.checked=!1)}),contInputs=0}async function waitResponse(e,t="129.5px",a=1){var o="";1==a?(o+='<div class="d-flex justify-content-center align-items-center w-100" style="width:100% !important;height:'+t+'" width:100% !important;height:50px" id="contenedorWait">',o+=' <div class="spinner-grow" role="status">',o+='<span class="visually-hidden">Loading...</span>',o+="</div>",o+=' <div class="spinner-grow" role="status">',o+='<span class="visually-hidden">Loading...</span>',o+="</div>",o+=' <div class="spinner-grow" role="status">',o+='<span class="visually-hidden">Loading...</span>',o+="</div>",o+="</div>"):(e.innerHTML="",o+='<td colspan="8" valign="top">',o+='<div class="d-flex justify-content-center align-items-center w-100" style="width:100% !important;height:'+t+'" id="contenedorWait">',o+=' <div class="spinner-grow" role="status">',o+='<span class="visually-hidden">Loading...</span>',o+="</div>",o+=' <div class="spinner-grow" role="status">',o+='<span class="visually-hidden">Loading...</span>',o+="</div>",o+=' <div class="spinner-grow" role="status">',o+='<span class="visually-hidden">Loading...</span>',o+="</div>",o+="</div>",o+="</td>"),document.querySelector(e).innerHTML=o}async function saveEditDoc(e){const t=document.querySelectorAll(".edit-campos"+e),a=Array.apply(null,t),o=document.getElementById("aliasDoc").value;var i="";const s=[];let l;if(a.forEach(e=>{let t=e.name,a=e.value;if(""==e.value){e.classList.add("errorInput");const a=document.createElement("div");a.id="divAlerta"+t,a.textContent="El campo "+t+" es OBLIGATORIO",a.style.color="red";let o=document.getElementById(t);document.getElementById("divAlerta"+t)||o.appendChild(a)}else{e.classList.remove("errorInput");const o=document.getElementById("divAlerta"+t);o&&(o.innerHTML=""),"keywords"==t?l=a:s.push({nombre:t,valor:a})}}),a.length==s.length+1){const t=new FormData;t.append("id",e),t.append("keywords",l),t.append("data",JSON.stringify(s)),t.append("alias",o),console.log([...t]);let a=URL_BASE+"/documento/update";const n=await fetch(a,{method:"POST",headers:{token:token},body:t}),r=await n.json();console.log(r),r.exito?Swal.fire({position:"top-end",icon:"success",title:r.exito,showConfirmButton:!1,timer:1500}).then(()=>{$("#exampleModalEditar"+e).modal("hide"),dibujarPadreAndCarpetas(r.padre)}):r.error?Swal.fire({icon:"error",title:"ERROR",text:r.error}):r.archivo?Swal.fire({icon:"error",title:"ERROR",text:r.archivo}):r.exit?Swal.fire({icon:"warning",title:r.exit,showConfirmButton:!1,text:"Sesión expirada, vuelva a iniciar sesión",timer:3e3}).then(()=>{window.location.href=URL_BASE+"/?r=8"}):(i+='<ul class="alert bg-white px-5 mt-3" style="border-radius:5px;border:1px solid red"  style="width:100%" >',console.log("swf",r.alertas.error),r.alertas.error.forEach(e=>{i+='<li class="text-danger"  >',i+=e,i+="</li>"}),i+="</ul>",document.getElementById("alertasEditarMetadata"+e).innerHTML=i),alertas()}}async function mostrarDocsPro(e){configDocs.mostrarAllDocs=!0,$.ajax({data:{tipo:"allDocs",id:e},url:URL_BASE+"/carpeta/datos",type:"POST",headers:{token:token},dataType:"json"}).done(t=>{t.exit&&Swal.fire({icon:"warning",title:t.exit,showConfirmButton:!1,text:"Sesión expirada, vuelva a iniciar sesión",timer:3e3}).then(()=>{window.location.href=URL_BASE+"/?r=8"}),waitResponse(".docsContenido","50px",2),setTimeout(()=>{if(0==t.length){'<td colspan="8" valign="top">','<div class="px-5 py-2 mt-3 w-100 d-flex justify-content-center">','<h4 class="" style="color:red">No Existen Documentos</h4>',"</div>","</div>","</td>",document.querySelector("#contenedorWait").innerHTML='<td colspan="8" valign="top"><div class="px-5 py-2 mt-3 w-100 d-flex justify-content-center"><h4 class="" style="color:red">No Existen Documentos</h4></div></div></td>'}else dibujarDocs(e,t)},500)}).fail(e=>{console.log(e)})}async function agregarDocumento(e){let t=await traerFormularios(),a=await traerSeccion(e);var o="";document.getElementById("dibujar-tabla").innerHTML="",o+='<h1 class="text-black mb-3"><strong>Agregar Documentos en '+a.seccion+"</strong></h1>",o+='<div class="mb-3">',o+='<div class="d-flex justify-content-start">',o+='<a class=" btn btn-outline-danger " onclick="dibujarPadreAndCarpetas('+e+')"><i class="fa-solid fa-arrow-left fa-2x"></i> <span class="span-boton">Regresar</span></a>',o+="</div>",o+="</div>",o+='<div class="contenedor-crearUsuario bg-light contenedor-carpetas px-3">',o+='<h3 class="text-black mt-2 mb-4">Elija un Formulario para agregar el documento</h3>',o+='<div class="mb-3">',o+='<label for="exampleFormControlInput1" class="form-label"><strong>Formulario:</strong></label>',o+='<select class="form-select w-100" style="height:30px" id="seccion" onchange="elegirSeccionAgregar(this.value,'+e+')">',o+=' <option value="" selected disabled> -- Seleccione un formulario -- </option>',t.forEach(e=>{o+=' <option value="'+e.id+'">'+e.nombre+"</option>"}),o+="</select>",o+="</div>",o+="</div>",o+="</div>",document.getElementById("dibujar-js").innerHTML=o}async function elegirSeccionAgregar(e,t){var a="";let o=await traerFormulario(e);console.log("formulario escogido"),a+='<div class="contenedor-crearUsuario bg-light px-3">',a+='<h3 class="text-black mt-2 mb-4">Ingrese los datos del documento</h3>';let i=JSON.parse(o.campos),s=JSON.parse(o.keywords),l=JSON.parse(o.archivo).map(e=>"."+e);a+='<div class="row">',a+='<div class="mb-3 w-100" id="'+s.input+'" >',a+='<label class="form-label"><strong>Ingrese '+s.input+":</strong></label>",a+='<input type="'+s.type+'" class="form-control datos"  name="'+s.input+'" value="" placeholder="Agregue palabras clave del documento">',a+="</div>",i.forEach(e=>{const{input:t,type:o}=e;a+='<div class="mb-3 w-100" id="'+t+'">',a+='<label class="form-label"><strong>Ingrese '+t[0].toUpperCase()+t.substring(1)+":</strong></label>",a+="text"==o?'<textarea class="w-100 form-control datos" name="'+t+'" rows="5"></textarea>':' <input type="'+o+'" class="form-control datos"  name="'+t+'">',a+="</div>"}),a+="</div>",a+='<div class="mb-3 w-100" id="archivo">',a+='<label class="form-label"><strong>Cargar el archivo:</strong></label>',a+='<div class="d-flex justify-content-between">',a+=' <input type="file" class="form-control datos" style="width:96.3%" name="archivo" accept="'+l+'">',a+='<buttom type="buttom" title="Editar Nombre de archivo" class="btn btn-warning " onclick="inputAlias()" id="buttomAlias" ><i class="fa-solid fa-pen fa-2x"></i></buttom>',a+="</div>",a+="</div>",a+='<div class="mb-3 w-100" id="alias">',a+="</div>",a+='<div class="w-100 mt-2" id="alertas">',a+="</div>",a+='<div class="my-5 d-flex justify-content-center align-items-center">',a+='<a class="btn btn-success px-5 py-2" id="botonCrear" style="font-size:15px" onclick="saveArchivo('+o.id+","+t+')"><i class="fa-solid fa-floppy-disk"></i> <span style="margin-left:8px">Guardar</span></a>',a+="</div>",document.getElementById("dibujar-tabla").innerHTML=a}function inputAlias(){document.getElementById("alias").innerHTML='<label class="form-label"><strong>Ingrese el alias:</strong></label> <input type="text" class="form-control datos alias" id="valorAlias"  name="alias"><div class="d-flex justify-content-between"></div>'}async function saveArchivo(e,t){var a="";const o=document.querySelectorAll(".datos"),i=Array.apply(null,o),s=[];let l,n,r;i.forEach(e=>{let t=e.name,a=e.value;if(""==e.value){e.classList.add("errorInput");const a=document.createElement("div");a.id="divAlerta"+t,a.textContent="El campo "+t.toUpperCase()+" es OBLIGATORIO",a.style.color="red";let o=document.getElementById(t);document.getElementById("divAlerta"+t)||o.appendChild(a)}else{e.classList.remove("errorInput");const o=document.getElementById("divAlerta"+t);switch(o&&(o.innerHTML=""),t){case"keywords":l=a;break;case"archivo":n=e.files[0];break;case"alias":r=a;break;default:s.push({nombre:t,valor:a})}}});let d=2;if(null==r&&null==r||(d=3),s.length==i.length-d){console.log("alias",r);const o=new FormData;o.append("idSeccion",t),o.append("idFormulario",e),o.append("keywords",l),o.append("path",n),o.append("data",JSON.stringify(s)),document.getElementById("valorAlias")&&o.append("alias",document.getElementById("valorAlias").value),console.log([...o]);let i=URL_BASE+"/documento/create";const d=await fetch(i,{method:"POST",headers:{token:token},body:o}),c=await d.json();console.log(c),c.exito?Swal.fire({position:"top-end",icon:"success",title:c.exito,showConfirmButton:!1,timer:1500}).then(()=>{dibujarPadreAndCarpetas(t)}):c.error?Swal.fire({icon:"error",title:"ERROR",text:c.error}):c.archivo?Swal.fire({icon:"error",title:"ERROR",text:c.archivo}):c.exit?Swal.fire({icon:"warning",title:c.exit,showConfirmButton:!1,text:"Sesión expirada, vuelva a iniciar sesión",timer:3e3}).then(()=>{window.location.href=URL_BASE+"/?r=8"}):(a+='<ul class="alert bg-white px-5 mt-3" style="border-radius:5px;border:1px solid red"  style="width:100%" >',c.alertas.error.forEach(e=>{a+='<li class="text-danger"  >',a+=e,a+="</li>"}),a+="</ul>",document.getElementById("alertas").innerHTML=a),alertas()}}async function deleteDoc(e){let t,a=await traerDocumento(e);console.log("doc",a),t=""==a.alias?a.codigo:a.alias,console.log("documento a eliminar",a),Swal.fire({title:"ELIMINAR",html:" Estas seguro de Eliminar de forma permamente el documento <strong>"+t+"</strong> ?",icon:"error",showCancelButton:!0,confirmButtonText:"Eliminar",confirmButtonColor:"#dc3545"}).then(o=>{o.isConfirmed&&$.ajax({data:{id:e},url:URL_BASE+"/documento/delete",type:"POST",headers:{token:token},dataType:"json"}).done(e=>{e.exito?Swal.fire({position:"top-end",icon:"success",title:e.exito,showConfirmButton:!1,timer:1500}).then(()=>{dibujarPadreAndCarpetas(a.idSeccion)}):e.error?Swal.fire({icon:"error",title:"ERROR",html:"<strong>"+t+"</strong> "+e.error}).then(()=>{dibujarPadreAndCarpetas(a.idSeccion)}):e.exit&&Swal.fire({icon:"warning",title:e.exit,showConfirmButton:!1,text:"Sesión expirada, vuelva a iniciar sesión",timer:3e3}).then(()=>{window.location.href=URL_BASE+"/?r=8"})}).fail(e=>{console.log(e)})})}function botonesGuardar(e,t="px-2",a="py-3"){document.getElementById(e).innerHTML="";let o="";o+='<buttom type="buttom" class="btn d-flex '+t+" "+a+' cursito justify-content-center align-items-center" style="background-color:#198754" disabled>',o+='<span class="spinner-border spinner-border-sm" style="width: 1.8rem; height: 1.8rem;color:white" role="status" aria-hidden="true"></span>',o+='<span style="margin-left:15px;font-size:14px;color:white">Cargando...</span>',o+="</button>",document.getElementById(e).innerHTML=o}async function createSeccion(e=0){var t="";const a=document.getElementById("seccion").value,o=document.getElementById("descripcion").value,i=document.getElementById("color").value;hexToRgb(i);const s=new FormData;s.append("idPadre",e),s.append("seccion",a),s.append("descripcion",o),s.append("color",i),console.log([...s]);const l=await fetch("http://localhost/gdagmcp/carpeta/create",{method:"POST",headers:{token:token},body:s}),n=await l.json();n.exito?Swal.fire({position:"top-end",icon:"success",title:n.exito,showConfirmButton:!1,timer:1500}).then(()=>{$("#exampleModal"+e).modal("hide"),dibujarPadreAndCarpetas(e)}):n.error?Swal.fire({icon:"error",title:"ERROR",text:n.error}).then(()=>{$("#exampleModal"+e).modal("hide"),dibujarPadreAndCarpetas(e)}):n.exit?Swal.fire({icon:"warning",title:n.exit,showConfirmButton:!1,text:"Sesión expirada, vuelva a iniciar sesión",timer:3e3}).then(()=>{window.location.href=URL_BASE+"/?r=8"}):(t+='<ul class="alert bg-white px-5 mt-3" style="border-radius:5px;border:1px solid red"  style="width:100%" >',n.alertas.error.forEach(e=>{t+='<li class="text-danger"  >',t+=e,t+="</li>"}),t+="</ul>",document.getElementById("alertas").innerHTML=t),alertas()}async function updateSeccion(e,t,a){var o="";const i=document.getElementById("seccion"+t).value,s=document.getElementById("descripcion"+t).value,l=document.getElementById("color"+t).value,n=document.getElementById("select"+t).value,r=new FormData;r.append("hijo",t),r.append("padre",e),r.append("seccion",i),r.append("descripcion",s),r.append("color",l),r.append("idPadre",n),1==a?r.append("tipo",1):r.append("tipo",2),console.log([...r]);const d=await fetch("http://localhost/gdagmcp/carpeta/update",{method:"POST",headers:{token:token},body:r}),c=await d.json();c.exito?Swal.fire({position:"top-end",icon:"success",title:c.exito,showConfirmButton:!1,timer:1500}).then(()=>{$("#exampleModal"+t).modal("hide"),$("#exampleModalEditar"+t).modal("hide"),1==a?dibujarPadreAndCarpetas(t):dibujarHijosPadre(e)}):c.error?Swal.fire({icon:"error",title:"ERROR",text:c.error}).then(()=>{$("#exampleModal"+t).modal("hide"),$("#exampleModalEditar"+t).modal("hide"),1==a?dibujarPadreAndCarpetas(t):dibujarHijosPadre(e)}):c.exit?Swal.fire({icon:"warning",title:c.exit,showConfirmButton:!1,text:"Sesión expirada, vuelva a iniciar sesión",timer:3e3}).then(()=>{window.location.href=URL_BASE+"/?r=8"}):(console.log("alertas",c),o+='<ul class="alert bg-white px-5 mt-3" style="border-radius:5px;border:1px solid red"  style="width:100%" >',c.alertas.error.forEach(e=>{o+='<li class="text-danger"  >',o+=e,o+="</li>"}),o+="</ul>",document.getElementById("alertas"+t).innerHTML=o),alertas()}async function deleteSeccion(e){const t=await traerSeccion(e);Swal.fire({title:"ELIMINAR",text:`Estas seguro de Eliminar de forma permamente a ${t.seccion}?`,icon:"error",showCancelButton:!0,confirmButtonText:"Eliminar",confirmButtonColor:"#dc3545"}).then(a=>{a.isConfirmed&&$.ajax({data:{id:e},url:URL_BASE+"/carpeta/delete",type:"POST",headers:{token:token},dataType:"json"}).done(e=>{console.log("response Eliminar",e),e.exito?Swal.fire({position:"top-end",icon:"success",title:e.exito,showConfirmButton:!1,timer:1500}).then(()=>{dibujarPadreAndCarpetas(t.idPadre)}):e.error?Swal.fire({icon:"error",title:"ERROR",html:"<strong>"+e.carpeta+"</strong> "+e.error}).then(()=>{dibujarPadreAndCarpetas(t.id)}):e.exit&&Swal.fire({icon:"warning",title:e.exit,showConfirmButton:!1,text:"Sesión expirada, vuelva a iniciar sesión",timer:3e3}).then(()=>{window.location.href=URL_BASE+"/?r=8"})}).fail(e=>{console.log(e)})})}async function abrirPdf(e,t){window.open(URL_BASE+"/public/archivos"+e)}document.addEventListener("click",e=>{e.target.classList.contains("form-check-input")&&(1==e.target.checked?contInputs++:contInputs--,contInputs>0?(document.getElementById("moverSelect").style="",document.getElementById("moverSelect").title="Click para elegir carpeta a mover"):(document.getElementById("moverSelect").style="cursor:not-allowed;background-color:#6C757D",document.getElementById("moverSelect").title="Debe marcar documentos para poder mover"))}),document.addEventListener("click",e=>{if(e.target.classList.contains("paginate_button")&&1==configDocs.saveBoton){document.getElementById("botonesDoc").classList.add("apagar"),document.getElementById("botonesMover").classList.remove("apagar");const e=document.querySelectorAll(".contenedor-opciones"),t=document.querySelectorAll(".contenedor-check"),a=Array.apply(null,e),o=Array.apply(null,t);for(let e=0;e<a.length;e++)o[e].classList.remove("apagar"),a[e].classList.add("apagar")}e.target.classList.contains("mover")&&(1==e.target.checked?configDocs.valuesInputMover.push(e.target.value):configDocs.valuesInputMover=configDocs.valuesInputMover.filter(t=>t!=e.target.value))});