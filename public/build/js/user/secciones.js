const URL_BASE="http://localhost/gdagmcp",token=JSON.parse(localStorage.getItem("token"));let unidades,secciones,roles,permisosDefault=[{id:"1",nombre:"Leer",status:"false"},{id:"2",nombre:"Escribir",status:"false"}];async function iniciarApp(){secciones=await traerHijos(0),dibujarHijos(0,secciones)}function alertas(){const e=document.querySelectorAll(".alert"),a=document.getElementById("alertas"),t=document.querySelector("#alertaTipo");e&&setTimeout(()=>{e.forEach((function(e){e.remove(),a&&(a.innerHTML=""),t&&(t.innerHTML="")}))},3e3)}function traerSecciones(){return new Promise((e,a)=>{let t=[];$.ajax({data:{tipo:"seccion"},url:URL_BASE+"/seccion/datos",type:"POST",headers:{token:token},dataType:"json"}).done(a=>{a.exit&&Swal.fire({icon:"warning",title:a.exit,showConfirmButton:!1,text:"Sesión expirada, vuelva a iniciar sesión",timer:3e3}).then(()=>{window.location.href=URL_BASE+"/?r=8"}),0==a.length&&(console.log("secciones",t),e(t)),$.each(a,(o,i)=>{t.push(i),a.length==o+1&&e(t)})}).fail(e=>{a(e)})})}function traerFormularios(){return new Promise((e,a)=>{let t=[];$.ajax({data:{tipo:"formularios"},url:URL_BASE+"/seccion/datos",type:"POST",headers:{token:token},dataType:"json"}).done(a=>{a.exit&&Swal.fire({icon:"warning",title:a.exit,showConfirmButton:!1,text:"Sesión expirada, vuelva a iniciar sesión",timer:3e3}).then(()=>{window.location.href=URL_BASE+"/?r=8"}),0==a.length&&e(t),$.each(a,(o,i)=>{t.push(i),a.length==o+1&&e(t)})}).fail(e=>{a(e)})})}function traerDocs(e){return new Promise((a,t)=>{let o=[];$.ajax({data:{id:e,tipo:"documentos"},url:URL_BASE+"/seccion/datos",type:"POST",headers:{token:token},dataType:"json"}).done(e=>{e.exit&&Swal.fire({icon:"warning",title:e.exit,showConfirmButton:!1,text:"Sesión expirada, vuelva a iniciar sesión",timer:3e3}).then(()=>{window.location.href=URL_BASE+"/?r=8"}),0==e.length&&a(0),$.each(e,(t,i)=>{o.push(i),e.length==t+1&&a(o)})}).fail(e=>{t(e)})})}function traerHijos(e=0){return new Promise((a,t)=>{let o=[];$.ajax({data:{id:e,tipo:"hijos"},url:URL_BASE+"/seccion/datos",type:"POST",headers:{token:token},dataType:"json"}).done(e=>{e.exit&&Swal.fire({icon:"warning",title:e.exit,showConfirmButton:!1,text:"Sesión expirada, vuelva a iniciar sesión",timer:3e3}).then(()=>{window.location.href=URL_BASE+"/?r=8"}),0==e.length&&a(o),$.each(e,(t,i)=>{o.push(i),e.length==t+1&&a(o)})}).fail(e=>{t(e)})})}async function dibujarAtras(e){let a=await traerSecciones(),t=a.find(a=>a.id==e),o=a.filter(e=>e.idPadre==t.idPadre);dibujarHijos(t.idPadre,o)}function hexToRgb(e){const a=e.match(/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})$/i);if(a)return a.slice(1).map(e=>parseInt(e,16));const t=e.match(/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i);return t?t.slice(1).map(e=>17*parseInt(e,16)):0}function colorCarpetas(e){var a="";return a+='<div class="p-3 padreCarpeta">',a+='<div class="">',a+='<a class="btn hoverCarpeta" style="border:1px solid #e2e4e6" onclick="entrarSeccion('+e.id+')">',a+='<div class="row justify-content-center align-items-center  widthCarpeta ">',a+='<div class="">',a+='<i class="fa-regular fa-folder-open" style="font-size:40px;margin-bottom:10px;color:'+e.color+'"></i>',a+='<div style="margin-bottom:-7px"><p style="font-weight:bold">'+(e.seccion[0].toUpperCase()+e.seccion.substring(1))+"</p></div>",a+="</div>",a+="</div>",a+="</a>",a+='<div class="d-flex justify-content-center align-items-center elip">',a+='<buttom class="btn btn-outline-secondary botonesCarpeta btn-hover dropdown-toggle py-2 px-3"  style="border:none" data-bs-toggle="dropdown" aria-expanded="false" type="buttom">',a+='<i class="fa-solid fa-ellipsis-vertical fa-xl elip" ></i>',a+="</buttom>",a+='<ul class="dropdown-menu dropdown-menu-dark">',a+='<li class="puntero"><a class="dropdown-item" data-bs-toggle="modal" data-bs-target="#exampleModal'+e.id+'"><i class="fa-solid fa-pen-to-square" style="margin-right:7px"></i>Editar</a></li>',a+='<li class="puntero"><a class="dropdown-item" onclick="deleteSeccion('+e.id+')"><i class="fa-solid fa-trash" style="margin-right:7px"></i>Eliminar</a></li>',a+=" </ul>",a+="</div>",a+="</div>"}function buscarCarpeta(e){document.getElementById("divBtnBuscar").innerHTML="",console.log("seecionActual",e);var a="";a+='<div class=" d-flex  justify-content-end" >',a+='<input style="width:193.5px;height:32.3px" class="form-control" id="buscarFocus" type="text" placeholder="Ingrese nombre de carpeta" onKeyUp="escucharCarpeta(this.value,'+(null!=e?e:0)+')">',a+="</div>",document.getElementById("divBtnBuscar").innerHTML=a,document.getElementById("buscarFocus").focus()}async function dibujarHijos(e,a){var t="";let o=await traerSecciones(),i=o.find(a=>a.id==e);t+='<div class="d-flex justify-content-center padreAtras">',t+='<div class="d-flex justify-content-center hijoAtras">',t+='<a class=" btn btn-outline-danger '+(null==i?"noVisible":"")+' " onclick="dibujarAtras('+e+')"><i class="fa-solid fa-arrow-left-long fa-2x"></i> <span class="span-boton">Atrás</span></a>',t+="</div>",null==i?t+='<h1 class="text-black mb-3"><strong>Administrar Carpetas</strong></h1>':(t+='<div class="d-flex flex-column justify-content-center">',t+='<div class="d-flex justify-content-center">',t+='<h1 class="text-black mb-3"><i class="fa-solid fa-folder-open fa-xl" style="margin-right:7px;color:'+i.color+'"></i><strong>'+i.seccion+"</strong></h1>",t+='<button type="button" class="btn btn-outline-secondary dropdown-toggle" data-bs-toggle="dropdown" style="margin-left:5px;margin-top:4px;width:25px;height:30px;border-radius:15px">',t+='<i class="fa-solid fa-ellipsis-vertical fa-xl "></i>',t+="</button>",t+='<ul class="dropdown-menu dropdown-menu-dark">',t+=' <li class="puntero"><a class="dropdown-item" data-bs-toggle="modal" data-bs-target="#exampleModalEditar'+i.id+'"><i class="fa-solid fa-pen-to-square" style="margin-right:7px"></i>Editar</a></li>',t+='<li class="puntero"><a class="dropdown-item" onclick="deleteSeccion('+i.id+')"><i class="fa-solid fa-trash" style="margin-right:7px"></i>Eliminar</a></li>',t+="</ul>",t+="</div>",t+='<h3 class="text-black mt-3 mb-4">'+i.descripcion+"</h3>",t+="</div>"),t+="</div>",t+='<div class="d-flex justify-content-end mt-2">',t+='<div style="margin-right:5px" id="divBtnBuscar">',t+='<a class="btn btn-outline-primary" onclick="buscarCarpeta('+(null!=i?i.id:0)+')"><i class="fa-solid fa-magnifying-glass fa-2x"></i><span class="span-boton">Carpeta</span></a>',t+="</div>",t+="<div>",t+='<a class=" btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal'+e+'" id="'+e+'"><i class="fa-solid fa-plus fa-2x"></i><span class="span-boton">Carpeta</span></a>',t+="</div>",t+="</div>",t+='<div class="contenedor-carpetas my-4">',t+=dibujarCarpetas(a,e,JSON.stringify(o)),t+="</div>",t+='<div class="modal fade" id="exampleModal'+e+'" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">',t+='<div class="modal-dialog">',t+='<div class="modal-content">',t+='  <div class="modal-header bg-black">',t+=null==i?'   <h5 class="modal-title text-white">Crear Carpeta</h5>':'   <h5 class="modal-title text-white">Agregar Carpeta en '+i.seccion+"</h5>",t+='<button type="button" class="btn text-white" style="font-size:11px" data-bs-dismiss="modal" aria-label="Close"><i class="fa-solid fa-x fa-lg"></i></button>',t+="  </div>",t+='  <div class="modal-body">',t+='<h3 class="text-black mt-2 mb-4">Ingresar datos de la Carpeta</h3>',t+='<div class="mb-3">',t+='<label  class="form-label"><strong>Nombre:</strong></label>',t+='<input type="text" class="form-control" id="seccion" name="seccion" placeholder="Ingrese nombre">',t+="</div>",t+='<div class="mb-2">',t+='<label  class="form-label"><strong>Descripción:</strong></label>',t+='<textarea class="form-control" rows="5" id="descripcion" placeholder="Ingrese descripción"></textarea>',t+="</div>",t+='<div class="mb-3">',t+='<label  class="form-label"><strong>Color:</strong></label>',t+='<input type="color" class="form-control w-25" id="color" name="color">',t+="</div>",t+='<div class="w-100 mt-2" id="alertas">',t+="</div>",t+="</div>",t+='<div class="modal-footer">',t+='<button type="button" class="btn btn-outline-danger" data-bs-dismiss="modal">Cancelar</button>',t+=null==i?'<a class="btn btn-success" id="botonCrear" onclick="createSeccion(0)"><i class="fa-solid fa-floppy-disk"></i> <span style="margin-left:8px">Guardar</span></a>':'<a class="btn btn-success" id="botonCrear" onclick="createSeccion('+e+')"><i class="fa-solid fa-floppy-disk"></i> <span style="margin-left:8px">Guardar</span></a>',t+="</div>",t+="</div>",t+="</div>",t+="</div>",void 0!==i&&(t+='<div class="modal fade" id="exampleModalEditar'+i.id+'" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">',t+='<div class="modal-dialog">',t+='<div class="modal-content">',t+='  <div class="modal-header bg-black">',t+='   <h5 class="modal-title text-white">Editar Carpeta</h5>',t+='<button type="button" class="btn text-white" style="font-size:11px" data-bs-dismiss="modal" aria-label="Close"><i class="fa-solid fa-x fa-lg"></i></button>',t+="  </div>",t+='  <div class="modal-body">',t+='<h3 class="text-black mt-2 mb-4">Editar datos de Carpeta <strong>'+i.seccion+"</strong></h3>",t+='<div class="mb-3">',t+='<label  class="form-label"><strong>Nombre:</strong></label>',t+='<input type="text" class="form-control" id="seccion'+i.id+'" placeholder="Ingrese nombre" value="'+i.seccion+'">',t+="</div>",t+='<div class="mb-3">',t+='<label  class="form-label"><strong>Descripción:</strong></label>',""!=i.descripcion?t+='<textarea class="form-control" rows="5" id="descripcion'+i.id+'" >'+i.descripcion+"</textarea>":t+='<textarea class="form-control" rows="5" id="descripcion'+i.id+'" placeholder="Esta Seccion no tiene descripcion" ></textarea>',t+="</div>",t+='<div class="mb-3">',t+='<label  class="form-label"><strong>Color:</strong></label>',t+='<input type="color" class="form-control w-25 puntero" id="color'+i.id+'" value="'+i.color+'">',t+="</div>",t+='<div class="w-100 mt-2" id="alertas'+i.id+'">',t+="</div>",t+="</div>",t+='<div class="modal-footer">',t+='<button type="button" class="btn btn-outline-danger" data-bs-dismiss="modal">Cancelar</button>',t+='<a class="btn btn-success" id="botonCrear" onclick="updateSeccion('+i.id+","+i.id+',1)"><i class="fa-solid fa-floppy-disk"></i> <span style="margin-left:8px">Guardar</span></a>',t+="</div>",t+="</div>",t+="</div>",t+="</div>"),console.log("seccionActual",i),document.getElementById("dibujar-js").innerHTML=t,document.getElementById("dibujar-tabla").innerHTML="",e>0&&await dibujarDocs(e,i.seccion),a.forEach(e=>{console.log("seccion",e.id),$("#select"+e.id).select2({dropdownParent:$("#exampleModal"+e.id)})})}function dibujarCarpetas(e,a,t){let o=JSON.parse(t);var i="";return 0===e.length?(i="",i+='<section class=""  id="contenedorCarpetas">',i+='<div class=" d-flex justify-content-center" style="flex-wrap:wrap">',i+='<div class="alert  px-5 py-2 mt-3 w-100 ">',i+='<div class="d-flex justify-content-center align-items-center">',i+='<h4 class="" style="color:red">No Existen Carpetas</h4>',i+="</div>",i+="</div>",i+="</div>",i+="</section>"):(i="",i+='<section id="contenedorCarpetas">',i+='<div class=" d-flex justify-content-center" style="flex-wrap:wrap">',e.forEach(e=>{console.log("hijo",e),i+=colorCarpetas(e),i+="</div>",i+='<div class="modal fade" id="exampleModal'+e.id+'" tabindex="-1" aria-labelledby="exampleModalLabel'+e.id+'" aria-hidden="true">',i+='<div class="modal-dialog">',i+='<div class="modal-content">',i+='  <div class="modal-header bg-black">',i+='   <h5 class="modal-title text-white">Editar</h5>',i+='<button type="button" class="btn text-white" style="font-size:11px" data-bs-dismiss="modal" aria-label="Close"><i class="fa-solid fa-x fa-lg"></i></button>',i+="  </div>",i+='  <div class="modal-body">',i+='<h3 class="text-black mt-2 mb-4">Edite la carpeta <strong>'+e.seccion+"</strong></h3>",i+='<div class="mb-3">',i+='<label  class="form-label"><strong>Nombre:</strong></label>',i+='<input type="text" class="form-control" id="seccion'+e.id+'" value="'+e.seccion+'">',i+="</div>",i+='<div class="mb-3">',i+='<label for="exampleFormControlInput1" class="form-label"><strong>Descripción:</strong></label>',""==e.descripcion?i+='<textarea class="form-control" rows="5" id="descripcion'+e.id+'" placeholder="Esta Sección no tiene descripción"></textarea>':i+='<textarea class="form-control" rows="5" id="descripcion'+e.id+'" >'+e.descripcion+"</textarea>",i+="</div>",i+='<div class="mb-3">',i+='<label class="form-label"><strong>Color:</strong></label>',i+='<input type="color" class="form-control w-50 puntero" id="color'+e.id+'" value="'+e.color+'">',i+="</div>",i+='<div class="mb-3">',i+='<div class="w-100">',i+='<label class="form-label"><strong>Mover Carpeta:</strong></label>',i+="</div>",i+='<div class="mb-3">',i+='<select style="width:50%" id="select'+e.id+'" class="js-example-basic-single" >',console.log("sec",o),o.forEach(e=>{i+='<optgroup label="'+e.seccion+'"></optgroup>',i+='<option value="'+e.id+'">'+e.path+"</option>",i+="</optgroup>"}),i+="</select>",i+="</div>",i+='<div class="w-100 mt-4" id="alertas'+e.id+'">',i+="</div>",i+="</div>",i+="</div>",i+='<div class="modal-footer">',i+='<button type="button" class="btn btn-outline-danger" data-bs-dismiss="modal">Cancelar</button>',i+='<a class="btn btn-success" id="botonCrear" onclick="updateSeccion('+a+","+e.id+',2)"><i class="fa-solid fa-floppy-disk"></i> <span style="margin-left:8px">Guardar</span></a>',i+="</div>",i+="</div>",i+="</div>",i+="</div>"}),i+="</div>",i+="</section>"),i}async function dibujarDocs(e,a){let t=await traerDocs(e);var o="";o+='<h3 class="mb-3 mt-5 text-black">Documentos de     <strong>'+a+"</strong></h3>",o+='<div class="d-flex mb-3 justify-content-end ">',o+='<a class="btn btn-warning" style="margin-right:3px" data-bs-toggle="modal" data-bs-target="#exampleModal'+e+'" id="'+e+'"><i class="fa-solid fa-plus fa-2x"></i></i> <span class="span-boton">Documento</span></a>',o+="</div>",o+='<table class="table" style="min-width:1000px" id="tablaDocsUltimo">',o+='<thead class="table-dark">',o+='<tr class="" style="text-transform:uppercase">',o+="<th>N°</th>",o+='<th class="">Alias</th>',o+='<th class="">Formulario</th>',o+='<th class="">Datos</th>',o+='<th class="">Responsable</th>',o+='<th class="">Fecha</th>',o+='<th class="">Estado</th>',o+='<th class="">Archivo</th>',o+="</tr>",o+="</thead>",o+='<tbody class="contenido" id="contenido">',t.length>0&&t.forEach((e,a)=>{o+="<tr>",o+="<td>"+(parseInt(a)+1)+"</td>",o+="<td>"+e.alias+"</td>",o+="<td>"+e.formulario+"</td>",o+='<td><buttom class="btn btn-secondary" style="margin-left:12px" data-bs-toggle="modal" data-bs-target="#exampleModalVer'+e.id+'">Ver</buttom></td>',o+="<td>"+e.responsable+"</td>",o+="<td>"+e.created_at.split(" ")[0]+"</td>",o+="<td>",0==e.status?o+='<span class="badge badge-pill bg-danger" style="margin-left:15px"><i class="fa-solid fa-circle-exclamation fa-lg"></i></span>':o+='<span class="badge badge-pill bg-success" style="margin-left:15px"><i class="fa-solid fa-circle-check fa-lg"></i></span>',o+="</td>",o+="<td>";const t="'"+e.path+"'",i="'"+e.codigo+"'";o+='<buttom title="Ver Documento" class="btn btn-outline-primary" style="margin-right:5px" onclick="abrirPdf('+t+","+i+')"><i class="fa-solid fa-file-pdf fa-2x"></i></buttom>',o+='<buttom title="Descargar Documento" class="btn btn-primary"><i class="fa-solid fa-file-pdf fa-2x"></i></buttom>',o+="</td>",o+="</tr>",o+='<div class="modal fade" id="exampleModalVer'+e.id+'" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">',o+=' <div class="modal-dialog modal-dialog-centered">',o+=' <div class="modal-content">',o+=' <div class="modal-header bg-black ">',o+=' <h5 class="modal-title text-white" id="exampleModalLabel">Metadatos del Documento <strong>'+e.codigo+"</strong></h5>",o+='<button type="button" class="btn text-white" style="font-size:13px" data-bs-dismiss="modal" aria-label="Close"><i class="fa-solid fa-x fa-lg"></i></button>',o+=" </div>",o+='  <div class="modal-body">';let s=e.keywords,l=JSON.parse(e.data);o+="<p><strong>KEYWORDS</strong></p>",o+="<p>"+s+"</p>",l.forEach(e=>{o+="<p><strong>"+e.nombre.toUpperCase()+"</strong></p>",o+="<p>"+e.valor+"</p>"}),o+="  </div>",o+=' <div class="modal-footer">',o+=' <button type="button" class="btn btn-outline-danger" data-bs-dismiss="modal">Cerrar</button>',o+="  </div>",o+="</div>",o+="</div>",o+="</div>"}),o+="</tbody>",o+="</table>",o+="</tbody>",document.getElementById("dibujar-tabla").innerHTML=o,$("#tablaDocsUltimo").DataTable()}async function entrarSeccion(e){dibujarHijos(e,await traerHijos(e))}async function guardarFormulario(e){let a=document.getElementById("formularioSelected"+e).value;var t="";if(""==a)document.getElementById("alertas"+e).classList.remove("apagar"),document.getElementById("btnSaveForm"+e).classList.add("apagar"),document.getElementById("formularioSelected"+e).classList.add("errorInput"),t+='<div class="d-flex justify-content-center align-items-center bg-danger mt-1 py-2 mx-3 text-white" style="font-size:14px;border:1px solid red;border-radius:5px">Debe seleccionar un Formulario</div>',document.getElementById("alertas"+e).innerHTML=t,setTimeout(()=>{document.getElementById("btnSaveForm"+e).classList.remove("apagar"),document.getElementById("formularioSelected"+e).classList.remove("errorInput"),document.getElementById("alertas"+e).classList.add("apagar")},2e3);else{botonesGuardar("btnSaveForm"+e,"px-0","py-0"),$("#exampleModalAddFormulario"+e).modal("hide");const a=new FormData,o=document.getElementById("formularioSelected"+e).value;a.append("idFormulario",o),a.append("idSeccion",e),console.log([...a]);let i=URL_BASE+"/seccion/formulario/agregar";const s=await fetch(i,{method:"POST",headers:{token:token},body:a}),l=await s.json();l.exito?Swal.fire({position:"top-end",icon:"success",title:l.exito,showConfirmButton:!1,timer:1500}).then(()=>{dibujarSecciones(),$("#tablaSecciones").DataTable()}):l.error?Swal.fire({icon:"error",title:"ERROR",text:l.error}).then(()=>{dibujarSecciones(),$("#tablaSecciones").DataTable()}):l.exit?Swal.fire({icon:"warning",title:l.exit,showConfirmButton:!1,text:"Sesión expirada, vuelva a iniciar sesión",timer:3e3}).then(()=>{window.location.href=URL_BASE+"/?r=8"}):(t+='<ul class="alert bg-white px-5 mt-3" style="border-radius:5px;border:1px solid red"  style="width:100%" >',l.alertas.error.forEach(e=>{t+='<li class="text-danger"  >',t+=e,t+="</li>"}),t+="</ul>",document.getElementById("alertas").innerHTML=t),alertas()}}function botonesGuardar(e,a="px-2",t="py-3"){document.getElementById(e).innerHTML="";let o="";o+='<buttom type="buttom" class="btn d-flex '+a+" "+t+' cursito justify-content-center align-items-center" style="background-color:#198754" disabled>',o+='<span class="spinner-border spinner-border-sm" style="width: 1.8rem; height: 1.8rem;color:white" role="status" aria-hidden="true"></span>',o+='<span style="margin-left:15px;font-size:14px;color:white">Cargando...</span>',o+="</button>",document.getElementById(e).innerHTML=o}async function createSeccion(e=0){var a="";const t=document.getElementById("seccion").value,o=document.getElementById("descripcion").value,i=document.getElementById("color").value;hexToRgb(i);const s=new FormData;s.append("idPadre",e),s.append("seccion",t),s.append("descripcion",o),s.append("color",i),console.log([...s]);const l=await fetch("http://localhost/gdagmcp/seccion/create",{method:"POST",headers:{token:token},body:s}),n=await l.json();n.exito?Swal.fire({position:"top-end",icon:"success",title:n.exito,showConfirmButton:!1,timer:1500}).then(()=>{$("#exampleModal"+e).modal("hide"),dibujarHijos(e,n.hijos)}):n.error?Swal.fire({icon:"error",title:"ERROR",text:n.error}).then(()=>{$("#exampleModal"+e).modal("hide"),dibujarHijos(e,n.hijos)}):n.exit?Swal.fire({icon:"warning",title:n.exit,showConfirmButton:!1,text:"Sesión expirada, vuelva a iniciar sesión",timer:3e3}).then(()=>{window.location.href=URL_BASE+"/?r=8"}):(a+='<ul class="alert bg-white px-5 mt-3" style="border-radius:5px;border:1px solid red"  style="width:100%" >',n.alertas.error.forEach(e=>{a+='<li class="text-danger"  >',a+=e,a+="</li>"}),a+="</ul>",document.getElementById("alertas").innerHTML=a),alertas()}async function updateSeccion(e,a,t){var o="";const i=document.getElementById("seccion"+a).value,s=document.getElementById("descripcion"+a).value,l=document.getElementById("color"+a).value,n=new FormData;n.append("hijo",a),n.append("padre",e),n.append("seccion",i),n.append("descripcion",s),n.append("color",l),1==t?n.append("tipo","updatePadre"):n.append("tipo","updateHijo"),console.log([...n]);const r=await fetch("http://localhost/gdagmcp/seccion/update",{method:"POST",headers:{token:token},body:n}),d=await r.json();d.exito?Swal.fire({position:"top-end",icon:"success",title:d.exito,showConfirmButton:!1,timer:1500}).then(()=>{$("#exampleModal"+a).modal("hide"),$("#exampleModalEditar"+a).modal("hide"),dibujarHijos(e,d.hijos)}):d.error?Swal.fire({icon:"error",title:"ERROR",text:d.error}).then(()=>{$("#exampleModal"+a).modal("hide"),$("#exampleModalEditar"+a).modal("hide"),dibujarHijos(e,d.hijos)}):d.exit?Swal.fire({icon:"warning",title:d.exit,showConfirmButton:!1,text:"Sesión expirada, vuelva a iniciar sesión",timer:3e3}).then(()=>{window.location.href=URL_BASE+"/?r=8"}):(console.log("alertas",d),o+='<ul class="alert bg-white px-5 mt-3" style="border-radius:5px;border:1px solid red"  style="width:100%" >',d.alertas.error.forEach(e=>{o+='<li class="text-danger"  >',o+=e,o+="</li>"}),o+="</ul>",document.getElementById("alertas"+a).innerHTML=o),alertas()}async function deleteSeccion(e){const a=(await traerSecciones()).find(a=>a.id==e);Swal.fire({title:"ELIMINAR",text:`Estas seguro de Eliminar de forma permamente a ${a.seccion}?`,icon:"error",showCancelButton:!0,confirmButtonText:"Eliminar",confirmButtonColor:"#dc3545"}).then(a=>{a.isConfirmed&&$.ajax({data:{id:e},url:URL_BASE+"/seccion/delete",type:"POST",headers:{token:token},dataType:"json"}).done(e=>{console.log("response Eliminar",e),e.exito?Swal.fire({position:"top-end",icon:"success",title:e.exito,showConfirmButton:!1,timer:1500}).then(()=>{dibujarHijos(e.padre,e.hijos)}):e.error?Swal.fire({icon:"error",title:"ERROR",html:"<strong>"+e.carpeta+"</strong> "+e.error}).then(()=>{dibujarHijos(e.padre,e.hijos)}):e.exit&&Swal.fire({icon:"warning",title:e.exit,showConfirmButton:!1,text:"Sesión expirada, vuelva a iniciar sesión",timer:3e3}).then(()=>{window.location.href=URL_BASE+"/?r=8"})}).fail(e=>{console.log(e)})})}document.addEventListener("DOMContentLoaded",iniciarApp()),escucharCarpeta=(e,a)=>{$.ajax({data:{tipo:"buscarCarpetas",value:e,id:a},url:URL_BASE+"/seccion/datos",type:"POST",headers:{token:token},dataType:"json"}).done(e=>{e.exit&&Swal.fire({icon:"warning",title:e.exit,showConfirmButton:!1,text:"Sesión expirada, vuelva a iniciar sesión",timer:3e3}).then(()=>{window.location.href=URL_BASE+"/?r=8"}),console.log(e),document.getElementById("contenedorCarpetas").innerHTML=" ";let t=dibujarCarpetas(e,a);document.getElementById("contenedorCarpetas").innerHTML=t}).fail(e=>{console.log(e)})};