const URL_BASE="http://localhost/gdagmcp",token=JSON.parse(localStorage.getItem("token")),CARPETA_BASE="/base";let secciones,roles;async function iniciarApp(){await dibujarTitulo(),await waitResponse("#contenedor-carpetas");let e=generarCarpetas(0,await traerSecciones());const t=document.getElementById("contenedor-carpetas"),n=dibujarArbolCarpetas(e);t.append(n)}function alertas(){const e=document.querySelectorAll(".alert"),t=document.getElementById("alertas"),n=document.querySelector("#alertaTipo");e&&setTimeout(()=>{e.forEach((function(e){e.remove(),t&&(t.innerHTML=""),n&&(n.innerHTML="")}))},3e3)}async function dibujarTitulo(){document.getElementById("contenedor-titulo").innerHTML='<h1 class="text-black"><strong>Administrar Permisos</strong></h1> <h3 class="text-black mt-3 mb-4">Seleccione una carpeta para elegir los permisos</h3>';const e=document.createElement("div");e.id="contenedor-carpetas",e.classList.add("contenedor-carpetas","mt-4","py-5","px-3");document.getElementById("dibujar-js").appendChild(e)}function traerSecciones(){return new Promise((e,t)=>{let n=[];$.ajax({data:{tipo:"seccion"},url:URL_BASE+"/carpeta/datos",type:"POST",headers:{token:token},dataType:"json"}).done(t=>{t.exit&&Swal.fire({icon:"warning",title:t.exit,showConfirmButton:!1,text:"Sesión expirada, vuelva a iniciar sesión",timer:3e3}).then(()=>{window.location.href=URL_BASE+"/?r=8"}),0==t.length&&e(n),$.each(t,(s,a)=>{n.push(a),t.length==s+1&&e(n)}),document.getElementById("contenedor-carpetas").innerHTML=""}).fail(e=>{t(e)})})}function dibujarArbolCarpetas(e){let t=e.nombre[0].toUpperCase()+e.nombre.substring(1);const n=document.createElement("ul");if(n.style="list-style-type:none;","0"!=e.id){const s=document.createElement("li");if(s.id="li"+e.id,0==e.hijos.length)s.innerHTML=`\n          <div class="d-flex align-items-center mt-1 mb-2" style="font-size:15px">\n            <div id="carpeta${e.id}" class="${"0"==e.id?"contenedor-carpetas-permiso px-3":""}">\n              <a class="moverC" style="text-decoration:none ;cursor:pointer" href="${URL_BASE}/permisos/carpeta?id=${e.id}">\n                <i class="fa-solid fa-folder-open fa-lg" style="margin-right:7px;color:${e.color}"></i>\n                <span style="color:#212529"><strong>${t}</strong></span>\n              </a>\n            </div>\n          </div>\n        `;else{let n='<i class="fa-solid fa-chevron-down fa-lg"></i>';s.innerHTML=`\n          <div class="d-flex align-items-center mt-1 mb-2" style="font-size:15px">\n            <div id="carpeta${e.id}" class="${"0"==e.id?"contenedor-carpetas-permiso px-3":""}">\n              <a class="moverC" style="text-decoration:none ;cursor:pointer" href="${URL_BASE}/permisos/carpeta?id=${e.id}">\n                <i class="fa-solid fa-folder-open fa-lg" style="margin-right:7px;color:${e.color}"></i>\n                <span style="color:#212529"><strong>${t}</strong></span>\n              </a> \n              <button class="btn btn-link" type="button" id="boton${e.id}" data-bs-toggle="collapse" data-bs-target="#collapse-${e.id}" style="margin-left:12px">\n                ${n}\n              </div>\n          </div>\n        `}if(n.appendChild(s),e.hijos.length>0){const t=document.createElement("div");t.id="collapse-"+e.id,0==e.id?t.classList.add("show"):t.classList.add("collapse");const n=document.createElement("ul");n.classList.add("list-group","ms-3","mb-3"),e.hijos.forEach(e=>{const t=dibujarArbolCarpetas(e);n.appendChild(t)}),t.appendChild(n),s.appendChild(t);const a=s.querySelector("#boton"+e.id),i=s.querySelector("#carpeta"+e.id);a.addEventListener("click",()=>{if(a.childNodes[1].classList.contains("fa-chevron-down")){i.classList.add("contenedor-carpetas-permiso","px-3");let e=document.createElement("i");e.classList.add("fa-solid","fa-chevron-up","fa-xl"),a.replaceChild(e,a.childNodes[1])}else if(a.childNodes[1].classList.contains("fa-chevron-up")){i.classList.remove("contenedor-carpetas-permiso","px-3");let e=document.createElement("i");e.classList.add("fa-solid","fa-chevron-down","fa-xl"),a.replaceChild(e,a.childNodes[1])}})}}else e.hijos.forEach(e=>{const t=dibujarArbolCarpetas(e);n.appendChild(t)});return n}function generarCarpetas(e,t){let n=t.find(t=>t.id==e);if(null==n)var s={nombre:"BASE",id:"0",color:"#212529",hijos:[]};else s={nombre:n.seccion,id:n.id,color:n.color,hijos:[]};return t.filter(t=>t.idPadre==e).forEach(e=>{let n=generarCarpetas(e.id,t);s.hijos.push(n)}),s}async function waitResponse(e,t="129.5px",n=1){var s="";1==n?(s+='<div class="d-flex justify-content-center align-items-center w-100" style="width:100% !important;height:'+t+'" width:100% !important;height:50px" id="contenedorWait">',s+=' <div class="spinner-grow" role="status">',s+='<span class="visually-hidden">Loading...</span>',s+="</div>",s+=' <div class="spinner-grow" role="status">',s+='<span class="visually-hidden">Loading...</span>',s+="</div>",s+=' <div class="spinner-grow" role="status">',s+='<span class="visually-hidden">Loading...</span>',s+="</div>",s+="</div>"):(e.innerHTML="",s+='<td colspan="8" valign="top">',s+='<div class="d-flex justify-content-center align-items-center w-100" style="width:100% !important;height:'+t+'" id="contenedorWait">',s+=' <div class="spinner-grow" role="status">',s+='<span class="visually-hidden">Loading...</span>',s+="</div>",s+=' <div class="spinner-grow" role="status">',s+='<span class="visually-hidden">Loading...</span>',s+="</div>",s+=' <div class="spinner-grow" role="status">',s+='<span class="visually-hidden">Loading...</span>',s+="</div>",s+="</div>",s+="</td>"),document.querySelector(e).innerHTML=s}document.addEventListener("DOMContentLoaded",iniciarApp());